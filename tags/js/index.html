
<!DOCTYPE html>
<html lang="zh-cn">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="煦涵驛">
    <title>标签: js - 煦涵驛</title>
    <meta name="author" content="煦涵">
    
        <meta name="keywords" content="WEB开发,前端开发,用户体验">
    
    
        <link rel="icon" href="https://zuojj.gitlab.io/assets/images/favicon.ico">
    
    
    <script type="application/ld+json">{}</script>
    <meta name="description" content="志不强者智不达">
<meta property="og:type" content="blog">
<meta property="og:title" content="煦涵驛">
<meta property="og:url" content="https://zuojj.gitlab.io/tags/js/index.html">
<meta property="og:site_name" content="煦涵驛">
<meta property="og:description" content="志不强者智不达">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="煦涵">
<meta property="article:tag" content="WEB开发">
<meta property="article:tag" content="前端开发">
<meta property="article:tag" content="用户体验">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@https:&#x2F;&#x2F;twitter.com&#x2F;zuojj">
    
    
        
    
    
        <meta property="og:image" content="https://avatars0.githubusercontent.com/u/5378965?s=460&amp;v=4"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-n2lvfzsmwt2hvavjmplmv122pj2aihmergs7judkqfrhxgekspfyz63ftv4u.min.css">

    <!--STYLES END-->
    

    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="2">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/%20"
            aria-label=""
        >
            煦涵驛
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="打开链接: /#about"
            >
        
        
            <img class="header-picture" src="https://avatars0.githubusercontent.com/u/5378965?s=460&amp;v=4" alt="作者的图片"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="2">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="阅读有关作者的更多信息"
                >
                    <img class="sidebar-profile-picture" src="https://avatars0.githubusercontent.com/u/5378965?s=460&amp;v=4" alt="作者的图片"/>
                </a>
                <h4 class="sidebar-profile-name">煦涵</h4>
                
                    <h5 class="sidebar-profile-bio"><p>因为热爱，所以坚持。</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="首页"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">首页</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="分类"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">分类</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="标签"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">标签</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="归档"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">归档</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="关于"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">关于</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/zuojj"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="mailto:zuojj.com@gmail.com"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="邮箱"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">邮箱</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="2"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2017/06/13/Babel/"
                            aria-label=": Babel"
                        >
                            Babel
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2017-06-13T12:56:01+08:00">
	
		    6月 13, 2017
    	
    </time>
    
        <span>发布在 </span>
        
    <a class="category-link" href="/categories/Web%E5%BC%80%E5%8F%91/">Web开发</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p><a href="http://babeljs.io/" target="_blank" rel="noopener">Babel</a>，下一代javascript编译器，当前版本 <code>v2.4.0</code> ，它可以处理ES6的所有新语法，并内置了React JSX扩展及Flow类型注解支持，如果对Flow不是很了解可以查看FED实验室微信公众号文章<a href="https://segmentfault.com/a/1190000009639356" target="_blank" rel="noopener">煦涵说Flow</a>。</p>
<p>Babel与JavaScript技术委员会（TC39）始终保持着高度一致，能够在ECMAScript新特性标准化之前为开发者提供现实可用的转码编译实现，以在ECMAScript规范最后定稿前获得来自世界各地开发者更多的反馈，从而间接推动了javascript的发展以及开发者在项目中尝试使用新技术。因此建议大家开始使用 Babel。</p>
<h2 id="Babel-配置文件-babelrc"><a href="#Babel-配置文件-babelrc" class="headerlink" title="Babel 配置文件 .babelrc"></a>Babel 配置文件 <code>.babelrc</code></h2><p>学习和使用Babel的<strong>第一步</strong>，配置 <code>.babelrc</code> 文件，该文件存放到项目根目录下，用来设置 Babel 的转码规则和插件。基本格式如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"presets"</span>: [],</span><br><span class="line">  <span class="string">"plugins"</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://babeljs.io/docs/plugins/#presets" target="_blank" rel="noopener">presets</a>的规则集如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># replaces es2015, es2016, es2017, latest</span></span><br><span class="line">$ yarn add babel-preset-env --dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># es2015</span></span><br><span class="line">$ yarn add babel-preset-es2015 --dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># es2016</span></span><br><span class="line">$ yarn add babel-preset-es2016 --dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># es2017 </span></span><br><span class="line">$ yarn add babel-preset-es2017 --dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># react</span></span><br><span class="line">$ yarn add babel-preset-react --dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># flow</span></span><br><span class="line">$ yarn add babel-preset-flow --dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># The TC39 categorizes proposals into the following stages:</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># Stage 0 - Strawman: just an idea, possible Babel plugin.</span></span><br><span class="line"><span class="comment"># Stage 1 - Proposal: this is worth working on.</span></span><br><span class="line"><span class="comment"># Stage 2 - Draft: initial spec.</span></span><br><span class="line"><span class="comment"># Stage 3 - Candidate: complete spec and initial browser implementations.</span></span><br><span class="line"><span class="comment"># Stage 4 - Finished: will be added to the next yearly release.</span></span><br><span class="line"><span class="comment"># For more information, be sure to check out the current TC39 proposals and its process document.</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># The TC39 stage process is also explained in detail across a few posts by Yehuda Katz (@wycatz) over at thefeedbackloop.xyz: # Stage 0 and 1, Stage 2, Stage 3, and Stage 4 coming soon.</span></span><br><span class="line"></span><br><span class="line">$ yarn add babel-preset-stage-x --dev</span><br></pre></td></tr></table></figure>
<p><a href="https://babeljs.io/docs/plugins/#transform-plugins" target="_blank" rel="noopener">plugins</a>插件集合很多。</p>
<p>新建一个配置文件 <code>.babelrc</code>，并增加如下代码，以供我们下面调试使用:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新建配置文件.babelrc，并添加如下内容</span></span><br><span class="line"><span class="comment"># &#123;</span></span><br><span class="line"><span class="comment">#   "presets": ["es2015"],</span></span><br><span class="line"><span class="comment">#   "plugins": []</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line">$ touch .babelrc</span><br><span class="line"><span class="comment"># 安装 babel-preset-es2015</span></span><br><span class="line">$ yarn add babel-preset-es2015 --dev</span><br></pre></td></tr></table></figure>

<h2 id="安装和使用-Babel"><a href="#安装和使用-Babel" class="headerlink" title="安装和使用 Babel"></a>安装和使用 Babel</h2><blockquote>
<p>ps: 本文将使用Yarn来安装依赖相关npm包，如果不了解Yarn的欢迎阅读公众号专栏<a href="https://segmentfault.com/a/1190000009626901" target="_blank" rel="noopener">煦涵说Yarn</a>。</p>
</blockquote>
<h3 id="命令行方式运行-babel-cli"><a href="#命令行方式运行-babel-cli" class="headerlink" title="命令行方式运行 babel-cli"></a>命令行方式运行 babel-cli</h3><p><code>babel-cli</code> 的 CLI 是一种在命令行下使用 Babel 编译文件的简单方法。</p>
<h4 id="全局安装"><a href="#全局安装" class="headerlink" title="全局安装"></a>全局安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局安装</span></span><br><span class="line">$ yarn global add babel-cli</span><br></pre></td></tr></table></figure>

<p>新建一个source.js文件，内容如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">arr = arr.map(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> item * index;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(arr);</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 输出结果到控制台</span></span><br><span class="line">$ babel source.js</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果到文件</span></span><br><span class="line">$ babel source.js --out-file dist.js</span><br><span class="line">or </span><br><span class="line">$ babel source.js -o dist.js</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果到目录</span></span><br><span class="line">$ babel /src --out-dir /dist</span><br><span class="line">or </span><br><span class="line">$ babel /src -d /dist</span><br></pre></td></tr></table></figure>

<h4 id="项目内安装-局部安装"><a href="#项目内安装-局部安装" class="headerlink" title="项目内安装(局部安装)"></a>项目内安装(局部安装)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 初始化一个项目package.json</span></span><br><span class="line">$ mkdir first-babel-proj</span><br><span class="line">$ <span class="built_in">cd</span> first-babel-proj</span><br><span class="line">$ yarn init </span><br><span class="line">$ yarn add babel-cli --dev</span><br></pre></td></tr></table></figure>
<p>修改package.json，添加如下文本</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "name": "babel-proj",</span><br><span class="line">  "version": "1.0.0",</span><br><span class="line">  "main": "index.js",</span><br><span class="line">  "license": "MIT",</span><br><span class="line">  "devDependencies": &#123;</span><br><span class="line">    "babel-cli": "^6.24.1"</span><br><span class="line">  &#125;,</span><br><span class="line"><span class="addition">+  "scripts": &#123;</span></span><br><span class="line"><span class="addition">+   "build": "babel src -d dist"</span></span><br><span class="line"><span class="addition">+  &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yarn run build</span><br></pre></td></tr></table></figure>

<h3 id="require方式运行-babel-register"><a href="#require方式运行-babel-register" class="headerlink" title="require方式运行 babel-register"></a>require方式运行 babel-register</h3><blockquote>
<p>ps: 这种方法并不适合正式产品环境使用。 在部署到生成环境之前预先编译会更好。 不过用在构建脚本或是其他本地运行的脚本中是非常合适的。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yarn add babel-register --dev</span><br></pre></td></tr></table></figure>
<p>新建compile.js文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'babel-register'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'./src/source.js'</span>);</span><br></pre></td></tr></table></figure>
<p>运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node compile.js</span><br></pre></td></tr></table></figure>
<p>运行结果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ [0, 2, 6, 12]</span><br></pre></td></tr></table></figure>

<h3 id="编程方式运行-babel-core"><a href="#编程方式运行-babel-core" class="headerlink" title="编程方式运行 babel-core"></a>编程方式运行 babel-core</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yarn add babel-core --dev</span><br></pre></td></tr></table></figure>
<p>字符串形式的 JavaScript 代码可以直接使用 <code>babel.transform</code> 来编译。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">babel.transform(<span class="string">"code();"</span>, options);</span><br><span class="line"><span class="comment">// =&gt; &#123; code, map, ast &#125;</span></span><br></pre></td></tr></table></figure>

<p>如果是文件的话，可以使用异步 api：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">babel.transformFile(<span class="string">"filename.js"</span>, options, <span class="function"><span class="keyword">function</span>(<span class="params">err, result</span>) </span>&#123;</span><br><span class="line">  result; <span class="comment">// =&gt; &#123; code, map, ast &#125;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>或者是同步 api：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">babel.transformFileSync(<span class="string">"filename.js"</span>, options);</span><br><span class="line"><span class="comment">// =&gt; &#123; code, map, ast &#125;</span></span><br></pre></td></tr></table></figure>

<p>要是已经有一个 Babel AST（抽象语法树）了就可以直接从 AST 进行转换。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">babel.transformFromAst(ast, code, options);</span><br><span class="line"><span class="comment">// =&gt; &#123; code, map, ast &#125;</span></span><br></pre></td></tr></table></figure>

<p>更多选项 <a href="https://babeljs.io/docs/usage/api/#options" target="_blank" rel="noopener">options</a>.</p>
<h2 id="Babel-与-Webpack"><a href="#Babel-与-Webpack" class="headerlink" title="Babel 与 Webpack"></a>Babel 与 Webpack</h2><p>使用 <a href="https://github.com/babel/babel-loader" target="_blank" rel="noopener">babel-loader</a> 插件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yarn add bable-loader --dev</span><br></pre></td></tr></table></figure>
<p>webpack.config.js 配置文件增加如下规则：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">    loader: <span class="string">'babel-loader'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Babel-低版本浏览器兼容"><a href="#Babel-低版本浏览器兼容" class="headerlink" title="Babel 低版本浏览器兼容"></a>Babel 低版本浏览器兼容</h2><ul>
<li><a href="https://segmentfault.com/a/1190000009613296" target="_blank" rel="noopener">煦涵说webpack-IE低版本兼容指南</a>，或者FED实验室公众号文章</li>
<li><a href="https://github.com/xcatliu/react-ie8" target="_blank" rel="noopener">React - IE低版本兼容</a></li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2017/06/13/Babel/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2017/05/28/Webpack%20-%20IE%E4%BD%8E%E7%89%88%E6%9C%AC%E5%85%BC%E5%AE%B9%E6%8C%87%E5%8D%97/"
                            aria-label=": Webpack - IE低版本兼容指南"
                        >
                            Webpack - IE低版本兼容指南
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2017-05-28T13:41:35+08:00">
	
		    5月 28, 2017
    	
    </time>
    
        <span>发布在 </span>
        
    <a class="category-link" href="/categories/Web%E5%BC%80%E5%8F%91/">Web开发</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p><a href="https://webpack.js.org/" target="_blank" rel="noopener">Webpack</a>，Webpack 是一个前端资源加载/打包工具，现在版本已经 release 到 v2.6.1，今天的文章不直接介绍Webpack的API及使用，而是对最近项目开发中使用Webpack打包时处理IE低版本(IE8及以下)浏览器兼容问题做一次总结。</p>
<p>PC端项目前端基础技术选型jQuery + ES6 + EJS + Babel + Webpack：</p>
<ul>
<li>jQuery：提供选择器和ajax接口兼容支持；</li>
<li>ES6：跟进前端趋势，方便向后兼容；</li>
<li>EJS：提供前端模板引擎支持；</li>
<li>Babel：提供 ES6 转码支持；</li>
<li>Webpack: 提高前端资源加载/打包；</li>
</ul>
<p>项目开发过程都在 Chrome 浏览器中，一切都OK，没有任何问题，当在IE9以下浏览器中调试发现好多坑，现总结如下，以后新手参考。</p>
<h2 id="Case-One-default-、-class、catch-ES3中保留字问题"><a href="#Case-One-default-、-class、catch-ES3中保留字问题" class="headerlink" title="Case One: default 、 class、catch ES3中保留字问题"></a>Case One: <code>default</code> 、 <code>class</code>、<code>catch</code> ES3中保留字问题</h2><p>报错信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SCRIPT1048: 缺少标识符</span><br></pre></td></tr></table></figure>
<p>对应代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">e.n = <span class="function"><span class="keyword">function</span> (<span class="params">t</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> n = t &amp;&amp; t.__esModule ? <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> t.default</span><br><span class="line">    &#125; : <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> t</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> e.d(n, <span class="string">"a"</span>, n), n</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>网上查找资料，webpack有一款loader插件<a href="https://www.npmjs.com/package/es3ify-loader" target="_blank" rel="noopener">es3ify-loader</a>来处理ES3的兼容问题，修改webpack配置，问题解决，添加规则如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [&#123;</span><br><span class="line">            test: <span class="regexp">/.js$/</span>,</span><br><span class="line">            enforce: <span class="string">'post'</span>, <span class="comment">// post-loader处理</span></span><br><span class="line">            loader: <span class="string">'es3ify-loader'</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个loader是干啥用的捏，就是把这些保留字给你加上引号，使用字符串的形式引用，请看实例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 编译前</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">t</span>) </span>&#123; <span class="keyword">return</span> t.default; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 编译后</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">t</span>) </span>&#123; <span class="keyword">return</span> t[<span class="string">"default"</span>]; &#125;</span><br></pre></td></tr></table></figure>

<h2 id="Case-Two-uglify-js产生问题"><a href="#Case-Two-uglify-js产生问题" class="headerlink" title="Case Two: uglify-js产生问题"></a>Case Two: uglify-js产生问题</h2><p>重新构建，在IE低版本浏览器预览，使用 <code>webpack.optimize.UglifyJsPlugin</code> 压缩时，又报上面同样的错误了，重新采用 beauty:true, build 发现引号被压缩掉了，究其原因，研究了下uglify-js默认配置，发现了 <code>compress.properties</code> 属性，增加build options如下，问题解决：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.optimize.UglifyJsPlugin(&#123;</span><br><span class="line">    compress: &#123;</span><br><span class="line">        properties: <span class="literal">false</span>,</span><br><span class="line">        warnings: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        beautify: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    sourceMap: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="Case-Three-uglify-js问题"><a href="#Case-Three-uglify-js问题" class="headerlink" title="Case Three: uglify-js问题"></a>Case Three: uglify-js问题</h2><p>重新构建，在IE低版本浏览器预览，使用 <code>webpack.optimize.UglifyJsPlugin</code> 压缩时，又报上面同样的错误了，报错代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="keyword">catch</span>: <span class="function"><span class="keyword">function</span> (<span class="params">t</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.then(<span class="literal">null</span>, t)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>继续查找uglify-js配置，发现 <code>output.quote_keys</code>，修改build options，问题解决：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.optimize.UglifyJsPlugin(&#123;</span><br><span class="line">    compress: &#123;</span><br><span class="line">        properties: <span class="literal">false</span>,</span><br><span class="line">        warnings: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        beautify: <span class="literal">true</span>,</span><br><span class="line">        quote_keys: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    sourceMap: <span class="literal">false</span></span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure>
<p>编译后：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"catch"</span>: <span class="function"><span class="keyword">function</span>(<span class="params">t</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.then(<span class="literal">null</span>, t);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Case-Four-uglify-js问题"><a href="#Case-Four-uglify-js问题" class="headerlink" title="Case Four: uglify-js问题"></a>Case Four: uglify-js问题</h2><p>重新构建，在IE低版本浏览器预览，报错信息如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SCRIPT3126: 无法设置未定义或 null 引用的属性</span><br></pre></td></tr></table></figure>
<p>继续分析压缩后代码，发现还是uglify-js问题，其mangle 配置属性 <code>mangle.screw_ie8</code> 默认为 true， 什么意思捏，意思就是把支持IE8的代码clear掉，screw you =&gt; 去你的，修改压缩配置项，重新编译，问题解决：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.optimize.UglifyJsPlugin(&#123;</span><br><span class="line">    compress: &#123;</span><br><span class="line">        properties: <span class="literal">false</span>,</span><br><span class="line">        warnings: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        beautify: <span class="literal">true</span>,</span><br><span class="line">        quote_keys: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    mangle: &#123;</span><br><span class="line">        screw_ie8: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    sourceMap: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="Case-Five-ES5的API兼容报错"><a href="#Case-Five-ES5的API兼容报错" class="headerlink" title="Case Five: ES5的API兼容报错"></a>Case Five: ES5的API兼容报错</h2><p>在 webpack 的 entry 入口文件top引入 <code>es5-shim</code> 问题解决</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'es5-shim'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'es5-shim/es5-sham'</span>);</span><br></pre></td></tr></table></figure>
<h2 id="Case-Six-Console-log-问题"><a href="#Case-Six-Console-log-问题" class="headerlink" title="Case Six: Console.log 问题"></a>Case Six: Console.log 问题</h2><p>在 webpack 的 entry 入口文件top引入 <code>console-polyfill</code> 问题解决</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'console-polyfill'</span>);</span><br></pre></td></tr></table></figure>

<h2 id="Case-Seven-Promise-兼容"><a href="#Case-Seven-Promise-兼容" class="headerlink" title="Case Seven: Promise 兼容"></a>Case Seven: Promise 兼容</h2><p>在 webpack 的 entry 入口文件top引入 <code>es6-promise</code> 问题解决</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'es6-promise'</span>);</span><br></pre></td></tr></table></figure>

<h2 id="Case-Eight-Object-defineProperty-问题"><a href="#Case-Eight-Object-defineProperty-问题" class="headerlink" title="Case Eight: Object.defineProperty 问题"></a>Case Eight: Object.defineProperty 问题</h2><p>这个case 应该说是最难搞的一个case了，耗时也比较长，关键点在于使用 <code>es5-shim</code>/<code>es5-sham</code>也有问题，查看你官网发现在低版本浏览器也会有问题，官网描述如下：</p>
<blockquote>
<p>⚠️ Object.defineProperty<br>In the worst of circumstances, IE 8 provides a version of this method that only works on DOM objects. This sham will not be installed. The given version of defineProperty will throw an exception if used on non-DOM objects.<br>In slightly better circumstances, this method will silently fail to set “writable”, “enumerable”, and “configurable” properties.<br>Providing a getter or setter with “get” or “set” on a descriptor will silently fail on engines that lack “defineGetter” and “defineSetter”, which include all versions of IE.<br><a href="https://github.com/es-shims/es5-shim/issues#issue/5" target="_blank" rel="noopener">https://github.com/es-shims/es5-shim/issues#issue/5</a></p>
</blockquote>
<p>那这个Object.defineProperty 是如何产生的呢，这个是babel编译后产生的，当我们在代码使用 <code>import</code> <code>export</code> ES6 Module时出现的，那你可能最直接的想法就是我不用ES6 Module了，改用Commonjs规范，OK，修改后编译，确实解决了问题，但是查看代码里还是有一段代码的，如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">e.d = <span class="function"><span class="keyword">function</span>(<span class="params">t, n, r</span>) </span>&#123;</span><br><span class="line">    e.o(t, n) || <span class="built_in">Object</span>.defineProperty(t, n, &#123;</span><br><span class="line">        <span class="string">"configurable"</span>: !<span class="number">1</span>,</span><br><span class="line">        <span class="string">"enumerable"</span>: !<span class="number">0</span>,</span><br><span class="line">        <span class="string">"get"</span>: r</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;, e.n = <span class="function"><span class="keyword">function</span>(<span class="params">t</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> n = t &amp;&amp; t.__esModule ? <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> t[<span class="string">"default"</span>];</span><br><span class="line">    &#125; : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> e.d(n, <span class="string">"a"</span>, n), n;</span><br><span class="line">&#125;, e.o = <span class="function"><span class="keyword">function</span>(<span class="params">t, e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.hasOwnProperty.call(t, e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看代码已经做了容错判断。</p>
<h2 id="Case-Nine-Object-defineProperty-问题"><a href="#Case-Nine-Object-defineProperty-问题" class="headerlink" title="Case Nine: Object.defineProperty 问题"></a>Case Nine: Object.defineProperty 问题</h2><p>重新构建，加入 <code>json3</code> 处理 JSON 对象兼容时，代码在此处抛出了异常：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> hasGetter = <span class="string">'get'</span> <span class="keyword">in</span> descriptor;</span><br><span class="line"><span class="keyword">var</span> hasSetter = <span class="string">'set'</span> <span class="keyword">in</span> descriptor;</span><br><span class="line"><span class="keyword">if</span> (!supportsAccessors &amp;&amp; (hasGetter || hasSetter)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(ERR_ACCESSORS_NOT_SUPPORTED);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>分析supportsAccessors代码逻辑：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> supportsAccessors = owns(prototypeOfObject, <span class="string">'__defineGetter__'</span>);</span><br></pre></td></tr></table></figure>
<p>通过断点调试，supportsAccessors值为false且hasGetter或者hasSetter时抛出了异常，也就是说当前js引擎不支持访问器属性，却在属性描述符中设置了get，set,那么就会抛出异常。查看 <a href="“defineGetter”的兼容情况是只兼容IE11">defineGetter</a> 的兼容情况，只兼容IE11，虽然IE9、IE10同样不支持defineGetter,不过他们直接支持Object.defineProperty方法和get语法，无需sham，所以代码并不会走到异常这里。但是IE8以下就扯淡了。解决这种情况只能修改源代码了。</p>
<p>至此，Webpack打包时，IE低版本浏览器(IE8及以下)遇到的兼容问题就总结这里，如果你有新的问题，欢迎留言。</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2017/05/28/Webpack%20-%20IE%E4%BD%8E%E7%89%88%E6%9C%AC%E5%85%BC%E5%AE%B9%E6%8C%87%E5%8D%97/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2017/05/20/Flow/"
                            aria-label=": Flow"
                        >
                            Flow
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2017-05-20T13:33:45+08:00">
	
		    5月 20, 2017
    	
    </time>
    
        <span>发布在 </span>
        
    <a class="category-link" href="/categories/Web%E5%BC%80%E5%8F%91/">Web开发</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p><a href="https://flow.org" target="_blank" rel="noopener">Flow</a>是Facebook出品的一个JavaScript代码的静态类型检查工具，它做了很多处理，使您的代码更快，更智能，更自信，更好的适应性。现在已经在前端比较流行的React 、Vue 等框架中得到使用。今天煦涵就和大家一起来学习Flow以及在实际项目中的使用。</p>
<h2 id="Flow-安装"><a href="#Flow-安装" class="headerlink" title="Flow 安装"></a>Flow 安装</h2><p>这里我们选择使用 <code>yarn</code>，当前你也可以使用 <code>npm</code>, 如果你对 <code>yarn</code>不是很了解，建议你阅读 <strong>煦涵说Yarn</strong>。首先我们先初始化一个 <code>flow</code> 项目，安装完编译器，然后再安装 <code>flow</code> 。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir flow-project</span><br><span class="line">cd flow-project</span><br><span class="line">yarn init</span><br><span class="line"></span><br><span class="line">yarn add --dev babel-cli babel-preset-flow babel-preset-es2015</span><br></pre></td></tr></table></figure>
<p>项目根目录下创建 <code>.babelrc</code> 文件，并增加如下内容：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"presets"</span>: [<span class="string">"flow"</span>, <span class="string">"es2015"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>安装 Flow:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev flow-bin</span><br></pre></td></tr></table></figure>

<p>运行 flow：<br>需要在根目录下新建一个 <code>.flowconfig</code> 文件，不然会报找不到该文件错误。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn run flow</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yarn run v0.16.1</span><br><span class="line">$ &quot;&#x2F;flow-proj&#x2F;node_modules&#x2F;.bin&#x2F;flow&quot; </span><br><span class="line">Launching Flow server for &#x2F;flow-proj</span><br><span class="line">Spawned flow server (pid&#x3D;17242)</span><br><span class="line">Logs will go to &#x2F;private&#x2F;tmp&#x2F;flow&#x2F;zSvue-workspacezSflow-proj.log</span><br><span class="line">No errors!</span><br><span class="line">✨  Done in 2.48s.</span><br></pre></td></tr></table></figure>

<h2 id="Flow-使用"><a href="#Flow-使用" class="headerlink" title="Flow 使用"></a>Flow 使用</h2><p>我们先在根目录下新建src目录，并新建一个index.js文件。同时在 <code>package.json</code> 文件中增加下面scripts内容，以方便我们后期的命令行编译。<br>index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @flow</span></span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>].map(<span class="function">(<span class="params">item:number, index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> item * item;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>package.json</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"build"</span>: <span class="string">"yarn run flow &amp;&amp; babel src -d lib"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行 <code>yarn run build</code>， 没有报错， 会在生成lib文件目录，index.js的 flow type 注释会被 remove 掉，同时进行了箭头函数到ES5的转换。<br>如果我修改上面index.js的代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @flow</span></span><br><span class="line">[<span class="string">'1'</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>].map(<span class="function">(<span class="params">item:number, index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> item * item;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>运行 <code>yarn run build</code>，会报如下类型检测错误：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">yarn run v0.16.1</span><br><span class="line">$ &quot;&#x2F;flow-proj&#x2F;node_modules&#x2F;.bin&#x2F;flow&quot; </span><br><span class="line">src&#x2F;index.js:3</span><br><span class="line">  3: [&#39;1&#39;,2,3,4].map((item:number, index) &#x3D;&gt; &#123;</span><br><span class="line">      ^^^ string. This type is incompatible with the expected param type of</span><br><span class="line">  3: [&#39;1&#39;,2,3,4].map((item:number, index) &#x3D;&gt; &#123;</span><br><span class="line">                           ^^^^^^ number</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Found 1 error</span><br><span class="line">error Command failed with exit code 2.</span><br><span class="line">info Visit https:&#x2F;&#x2F;yarnpkg.com&#x2F;en&#x2F;docs&#x2F;cli&#x2F;run for documentation about this command.</span><br><span class="line">error Command failed with exit code 1.</span><br><span class="line">info Visit https:&#x2F;&#x2F;yarnpkg.com&#x2F;en&#x2F;docs&#x2F;cli&#x2F;run for documentation about this command.</span><br></pre></td></tr></table></figure>

<p>更多类型坚持实例不再一一列举，官网有很多介绍type的例子。</p>
<h2 id="Flow-配置文件"><a href="#Flow-配置文件" class="headerlink" title="Flow 配置文件"></a>Flow 配置文件</h2><p>上面提到没有配置文件，会报错，<code>.flowconfig</code> 文件由以下5个部分组成：</p>
<ul>
<li>[include] –包含的文件或者目录</li>
<li>[ignore]  –忽略的文件或者目录，支持正则匹配</li>
<li>[libs]    –第三方库支持，项目根目录下的flow-typed目录作为库目录</li>
<li>[options] –默认键值对配置，某些选项可以使用命令行方式重载</li>
<li>[version] –期望使用的Flow版本</li>
</ul>
<h2 id="流行编辑器插件支持"><a href="#流行编辑器插件支持" class="headerlink" title="流行编辑器插件支持"></a>流行编辑器插件支持</h2><ul>
<li>Visual Studio Code: Flow-Language-Support </li>
<li>Sublime Text:Flow 和 SublimeLinter-flow<br>更多请参考：<a href="https://flow.org/en/docs/editors/" target="_blank" rel="noopener">https://flow.org/en/docs/editors/</a></li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2017/05/20/Flow/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2017/05/13/Yarn/"
                            aria-label=": Yarn"
                        >
                            Yarn
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2017-05-13T12:50:16+08:00">
	
		    5月 13, 2017
    	
    </time>
    
        <span>发布在 </span>
        
    <a class="category-link" href="/categories/Web%E5%BC%80%E5%8F%91/">Web开发</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p><a href="https://yarnpkg.com" target="_blank" rel="noopener">Yarn</a>是一个新的Javascript包管理器，它由Facebook, Google, Exponent and Tilde开发者共同开发完成。Yarn 不是 NPM 的fork版本，而是它的重新设计，Yarn 定位为”快速、可靠、安全的依赖管理工具”，它的目标是解决团队开发中使用 NPM 遇到的问题。</p>
<p>随着 Yarn 的诞生，越来越多的开发者转向了 Yarn，那么 NPM 在开发中有哪些问题，Yarn 是如何解决的呢？<br>NPM 一些潜在的问题:</p>
<ul>
<li>嵌套依赖 (npm 3.0版本已修复)</li>
<li>串行安装</li>
<li>单一个 package 来源（npmjs.com）</li>
<li>需要网络来安装软件包（尽管我们可以创建一个临时缓存）</li>
<li>允许程序包在安装时运行代码（不利于安全性）</li>
<li>不确定的包状态（不能确定项目的所有副本使用相同的包版本）</li>
</ul>
<p>Yarn 解决方案:</p>
<ul>
<li>单依赖包结构: 可以使用单一版本的依赖包，安装更快速，占用磁盘空间更少</li>
<li>并行安装: 并行下载依赖包，减少下载时间</li>
<li>多个包来源: Yarn 读取和安装 npmjs.com 和 Bower安装包，如果有个渠道down掉了，可以从另一个渠道下载包并安装</li>
<li>自动重试: 单个网络请求失败不会导致安装失败，请求在失败后会重试，这解决了由于临时网络问题而产生的构建异常</li>
<li>兼容 NPM: 从 NPM 切换到 Yarn 不需要做特殊兼容处理</li>
<li>yarn.lock: 用来管理 javascript 包，这个对于开发团队来说可能是最有用的功能了。 在package.json中，依赖的包版本可以被指定为一个范围，也可以不带版本号。这个可能会导致一种问题，团队内不同开发人员使用不同版本的软件包。我们都知道，复现环境的能力与完全相关的依赖关系对于高校的调试和新团队人员的融入至关重要。从包管理器（Bundler）中借鉴，Yarn 创建了 yarn.lock文件，用来记录项目使用每个包的确切版本。当将此文件提交至 SVN、GIT 等代码维护工具，可以保证项目的所有开发人员共享一套依赖包的版本号。</li>
</ul>
<h2 id="Yarn-的安装"><a href="#Yarn-的安装" class="headerlink" title="Yarn 的安装"></a>Yarn 的安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">brew install yarn</span><br><span class="line"></span><br><span class="line">&#x2F;* Yarn 团队不推荐 *&#x2F;</span><br><span class="line">npm install -g yarn</span><br></pre></td></tr></table></figure>
<p>不同平台安装方式各异，具体参见<a href="https://yarnpkg.com/zh-Hans/docs/install" target="_blank" rel="noopener">install</a></p>
<h2 id="NPM-CLI-vs-Yarn-CLI"><a href="#NPM-CLI-vs-Yarn-CLI" class="headerlink" title="NPM CLI vs Yarn CLI"></a>NPM CLI vs Yarn CLI</h2><ul>
<li>初始化项目<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm  init</span><br><span class="line">yarn init</span><br></pre></td></tr></table></figure></li>
<li>从 package.json 安装依赖<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br><span class="line">yarn</span><br></pre></td></tr></table></figure></li>
<li>安装指定包到依赖或者开发依赖<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm install --save [package]</span><br><span class="line">yarn add [package]</span><br><span class="line"></span><br><span class="line">npm install --save-dev [package]</span><br><span class="line">yarn add [package] [--dev&#x2F;-D]</span><br></pre></td></tr></table></figure></li>
<li>安装包到全局<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install --global [package]</span><br><span class="line">yarn global add [package]</span><br></pre></td></tr></table></figure></li>
<li>安装指定版本的包<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install [package]@[version]</span><br><span class="line">yarn add [package]@[version]</span><br></pre></td></tr></table></figure></li>
<li>重新下载所有包<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm rebuild</span><br><span class="line">yarn install --force</span><br></pre></td></tr></table></figure></li>
<li>卸载包<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall [package]</span><br><span class="line"></span><br><span class="line">npm uninstall --save [package]</span><br><span class="line">yarn remove [package]</span><br><span class="line"></span><br><span class="line">npm uninstall --save-dev [package]</span><br></pre></td></tr></table></figure></li>
<li>升级包<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm -rf node_modules &amp;&amp; npm install</span><br><span class="line">yarn upgrade</span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2>相比 NPM，Yarn解决了不确定依赖、网络问题、并行下载等问题。然而 NPM 是自己成功的牺牲品，随着越来越多的开发者转移使用 Yarn或者其他依赖平台，NPM 服务器可以更有效的使用。总之两个包管理器都很优秀，这种相互的关系，驱使着各自彼此往更优秀的方向前进，以惠及更多的开发者。</li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2017/05/13/Yarn/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2017/04/30/JSON/"
                            aria-label=": JSON"
                        >
                            JSON
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2017-04-30T13:34:16+08:00">
	
		    4月 30, 2017
    	
    </time>
    
        <span>发布在 </span>
        
    <a class="category-link" href="/categories/Web%E5%BC%80%E5%8F%91/">Web开发</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>JSON(Javascript Object Notaion, javascript 对象表示法)， 是一种数据交换格式，能够在服务器端交换数据， 2001年由Douglas Crockford提出，目的是取代繁琐笨重的XML格式。</p>
<p>JSON 数据格式的优点：</p>
<ul>
<li>与语言无关的文本数据格式</li>
<li>轻量、简单、易维护</li>
<li>是javascript编程语言的一个子集(<strong>Standard ECMA-262 3rd Edition - December 1999</strong>)， 符合javascript 语言语法，可以使用javascript提供的方法直接解析处理</li>
</ul>
<p>JSON 建立在两种数据结构上：</p>
<ul>
<li>键 / 值对：各种语言中可以为 字符串、对象、数组或者哈希表</li>
<li>有序列表（值）：各种语言中实现为数组、向量、列表或者序列</li>
</ul>
<h2 id="JSON的基本语法："><a href="#JSON的基本语法：" class="headerlink" title="JSON的基本语法："></a>JSON的基本语法：</h2><ul>
<li>JSON 对象</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"key"</span>: <span class="string">"value"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>JSON 数组</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">"value"</span>, <span class="string">"value"</span>, <span class="string">"value"</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li>value 可取值<br>value 可以是 String(必须使用双引号包裹)、Number、Boolean、null、Object、Array, 这些形式可以嵌套，value值不能是八进制、十六进制（0xF0F）、undefined、function、日期对象，看下面示例：</li>
</ul>
<p>合格的 JSON 格式：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123; </span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"煦涵"</span>, </span><br><span class="line">    <span class="string">"name"</span>: <span class="literal">null</span>, </span><br><span class="line">    <span class="string">"male"</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">"age"</span>: <span class="number">23</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123; </span><br><span class="line">    <span class="string">"brother"</span>: [<span class="string">"煦涵1"</span>, <span class="string">"煦涵2"</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123; </span><br><span class="line">    <span class="string">"brother"</span>: &#123;</span><br><span class="line">        <span class="string">"煦涵1"</span>: &#123;</span><br><span class="line">            <span class="string">"age"</span>: <span class="number">32</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"煦涵2"</span>: &#123;</span><br><span class="line">            <span class="string">"age"</span>: <span class="number">30</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[&#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"煦涵"</span></span><br><span class="line">    <span class="string">"age"</span>: <span class="number">30</span></span><br><span class="line">&#125;,&#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"张三"</span></span><br><span class="line">    <span class="string">"age"</span>: <span class="number">27</span></span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>
<p>不合格的 JSON 格式：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// key 必须用双引号包裹，value 如果是字符串必须用双引号包裹</span></span><br><span class="line"></span><br><span class="line">&#123; <span class="string">'name'</span>: <span class="string">"煦涵"</span> &#125; </span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, oxFOF] </span><br><span class="line">&#123; <span class="string">'name'</span>: <span class="literal">undefined</span> &#125; </span><br><span class="line">&#123; </span><br><span class="line">    <span class="string">'name'</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"煦涵"</span></span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line">&#123; <span class="string">'name'</span>: <span class="keyword">new</span> <span class="built_in">Date</span>() &#125;</span><br></pre></td></tr></table></figure>
<p>如果value的一个String（双引号包围）内包含 <code>\&quot;</code>、<code>\\</code>、<code>\/</code>、<code>\b</code>、<code>\f</code>、<code>\n</code>、<code>\r</code>、<code>\t</code>、<code>\u001f</code> 需要使用反斜杠<br>如果value的一个Number，不能使用八进制和十六进制数值<br>PS： value对空格没有限制要求</p>
<h2 id="JSON-对象"><a href="#JSON-对象" class="headerlink" title="JSON 对象"></a>JSON 对象</h2><p>聊完 JSON 下面我们来聊聊 JSON 对象，javascript 在 ES5中新增了 JSON 对象，用来处理 JSON 文本数据，实现字符串与 JSON 对象间的相互转换，<code>JSON.stringify ( value [ , replacer [ , space ] ] )</code> 和 <code>JSON.parse ( text [ , reviver ] )</code>， 前者是把 JSON 对象转换为 JSON 字符串，后者的把 JSON 字符串解析为 JSON 对象，下面来详细看看这个两个方法。</p>
<h3 id="JSON-stringify-value-replacer-space"><a href="#JSON-stringify-value-replacer-space" class="headerlink" title="JSON.stringify ( value [ , replacer [ , space ] ] )"></a>JSON.stringify ( value [ , replacer [ , space ] ] )</h3><ol>
<li>第一个参数： Value 必须项，可以是 Object, Array, String, Boolean, Number, Null.看几个例子：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"煦涵"</span>,</span><br><span class="line">    <span class="string">"age"</span> : <span class="number">28</span>,</span><br><span class="line">    <span class="string">"male"</span> : <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"brother"</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">    <span class="string">"parent"</span>: &#123;</span><br><span class="line">        <span class="string">"father"</span> : &#123;</span><br><span class="line">            <span class="string">"name"</span>: <span class="string">"name"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"mother"</span>: &#123;</span><br><span class="line">            <span class="string">"name"</span>: <span class="string">"name"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"other"</span>: <span class="literal">null</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// result</span></span><br><span class="line"><span class="string">"&#123;"</span>name<span class="string">":"</span>煦涵<span class="string">","</span>age<span class="string">":28,"</span>male<span class="string">":true,"</span>brother<span class="string">":["</span>B1<span class="string">","</span>B2<span class="string">","</span>B3<span class="string">"],"</span>parent<span class="string">":&#123;"</span>father<span class="string">":&#123;"</span>name<span class="string">":"</span>name<span class="string">"&#125;,"</span>mother<span class="string">":&#123;"</span>name<span class="string">":"</span>name<span class="string">"&#125;&#125;,"</span>other<span class="string">":null&#125;"</span></span><br></pre></td></tr></table></figure>

<p>当待转换值不是 JSON 的基本类型时：</p>
<ul>
<li>原始对象 item 值是 undefined、函数或 XML 对象，值会被过滤；</li>
<li>数组 item 是 undefined、函数或 XML 对象，值会被转成 null；</li>
<li>正则对象会被转换成空对象；</li>
<li>对象的不可遍历属性会被忽略；</li>
<li>八进制和十六进制会被转换成十进制;</li>
<li>特殊字符需要转义成反斜杠</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="literal">undefined</span>,</span><br><span class="line">    <span class="string">"age"</span> : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;<span class="keyword">return</span> <span class="number">28</span>&#125;,</span><br><span class="line">    <span class="string">"male"</span> : <span class="regexp">/male/g</span>,</span><br><span class="line">    <span class="string">"brother"</span>: [<span class="literal">undefined</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;<span class="keyword">return</span> abc&#125;, <span class="string">"B3"</span>, <span class="number">0xF</span>OF],</span><br><span class="line">    <span class="string">"parent"</span>: &#123;</span><br><span class="line">        <span class="string">"father"</span> : &#123;</span><br><span class="line">            <span class="string">"name"</span>: <span class="literal">undefined</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"mother"</span>: &#123;</span><br><span class="line">            <span class="string">"name"</span>: <span class="string">"name"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"other"</span>: <span class="literal">null</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// result: 正则被转出了空对象，undefined, function 被忽略或者转成 null</span></span><br><span class="line"></span><br><span class="line"><span class="string">"&#123;"</span>male<span class="string">":&#123;&#125;,"</span>brother<span class="string">":[null,null,"</span>B3<span class="string">", 3855],"</span>parent<span class="string">":&#123;"</span>father<span class="string">":&#123;&#125;,"</span>mother<span class="string">":&#123;"</span>name<span class="string">":"</span>name<span class="string">"&#125;&#125;,"</span>other<span class="string">":null&#125;"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 不可遍历属性 */</span></span><br><span class="line"><span class="keyword">var</span> demo = &#123;&#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperties(demo, &#123;</span><br><span class="line">    <span class="string">"name"</span>: &#123;</span><br><span class="line">        value: <span class="string">"煦涵"</span>,</span><br><span class="line">        enumerable: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"age"</span>: &#123;</span><br><span class="line">        value: <span class="number">28</span>,</span><br><span class="line">        enumerable: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">JSON</span>.stringify(demo);</span><br><span class="line"></span><br><span class="line"><span class="comment">// enumerable: 当且仅当该属性的 enumerable 为 true 时，该属性才能够出现在对象的枚举属性中,</span></span><br><span class="line"><span class="comment">// result: name 属性会被过滤</span></span><br><span class="line"><span class="string">"&#123;"</span>age<span class="string">":28&#125;"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 特殊字符处理-01 */</span></span><br><span class="line"><span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">    <span class="string">"special01"</span>: <span class="string">"回车 \r，换行 \n，退格 \b，换页 \f，Tab \t"</span>,</span><br><span class="line">    <span class="string">"special02"</span>: <span class="string">"双引号 \"，单引号 ', 斜杠 \/, 反斜杠 \\"</span>,</span><br><span class="line">    <span class="string">"special03"</span>: <span class="string">"unicdoe字符 \u001f"</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// result</span></span><br><span class="line"><span class="string">'&#123;"special01":"回车 \r，换行 \n，退格 \b，换页 \f，Tab \t","special02":"双引号 \"，单引号 '</span>, 斜杠 /, 反斜杠 \\<span class="string">","</span>special03<span class="string">":"</span>unicdoe字符 \u001f<span class="string">"&#125;'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/* 特殊字符处理-02 */</span></span><br><span class="line"><span class="string">var demo = &#123;&#125;</span></span><br><span class="line"><span class="string">demo.special01 = '回车 \r，换行 \n，退格 \b，换页 \f，Tab \t';</span></span><br><span class="line"><span class="string">demo.special02 = '双引号 "</span>，斜杠 /, 反斜杠\，end <span class="string">';</span></span><br><span class="line"><span class="string">demo.special03 = '</span>unicdoe字符 \u001f<span class="string">';</span></span><br><span class="line"><span class="string">JSON.stringify(demo);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// result, 双引号被转义了，反斜杠被忽略了</span></span><br><span class="line"><span class="string">'</span>&#123;<span class="string">"special01"</span>:<span class="string">"回车 \r，换行 \n，退格 \b，换页 \f，Tab \t"</span>,<span class="string">"special02"</span>:<span class="string">"双引号 \"，斜杠 /, 反斜杠，end "</span>,<span class="string">"special03"</span>:<span class="string">"unicdoe字符 \u001f"</span>&#125;<span class="string">'</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>第二个参数：replacer可选项，可以是 array or function</li>
</ol>
<ul>
<li>当replacer 是数组时，对第一个参数 value进行过滤，key 不在数组里的不会输出，这里需要注意的是，当第一个参数为Object时才有效，如果为Array，无效，看下面例子：</li>
<li>当replacer 是函数时，递归遍历所有的键，可以对对象进行format and replace 等操作</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* replacer 为数组 */</span></span><br><span class="line"><span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">    <span class="string">"0"</span>: <span class="string">"安徽省"</span>,</span><br><span class="line">    <span class="string">"1"</span>: <span class="string">"蚌埠市"</span>,</span><br><span class="line">    <span class="string">"2"</span>: <span class="string">"固镇县"</span></span><br><span class="line">&#125;, [<span class="number">0</span>,<span class="number">1</span>])</span><br><span class="line"><span class="comment">// result:</span></span><br><span class="line"><span class="string">'&#123;"0":"安徽省","1":"蚌埠市"&#125;'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">JSON</span>.stringify([</span><br><span class="line">    <span class="string">"安徽省"</span>,</span><br><span class="line">    <span class="string">"蚌埠市"</span>,</span><br><span class="line">    <span class="string">"固镇县"</span></span><br><span class="line">], [<span class="number">0</span>,<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// result</span></span><br><span class="line"><span class="string">'["安徽省","蚌埠市","固镇县"]'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* replacer 为函数 */</span></span><br><span class="line"><span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">    <span class="string">"0"</span>: <span class="string">"安徽省"</span>,</span><br><span class="line">    <span class="string">"1"</span>: <span class="string">"蚌埠市"</span>,</span><br><span class="line">    <span class="string">"2"</span>: <span class="string">"固镇县"</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">key, value</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// key: '', value: &#123;0: "安徽省", 1: "蚌埠市", 2: "固镇县"&#125;</span></span><br><span class="line">    <span class="built_in">console</span>.log(key, value);</span><br><span class="line">    <span class="keyword">return</span> value[<span class="number">0</span>] + value[<span class="number">1</span>] + value[<span class="number">2</span>];</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// result</span></span><br><span class="line"><span class="string">""</span>安徽省蚌埠市固镇县<span class="string">""</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>第三个参数：space 可选项，用于增加format字符的可读性，可取值 Number, String, 但长度不超过10个字符</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">JSON</span>.stringify(&#123;<span class="string">"name"</span>: <span class="string">"煦涵"</span>, <span class="string">"age"</span>: <span class="number">28</span>, <span class="string">"male"</span>: <span class="literal">true</span>, <span class="string">"other"</span>: <span class="literal">null</span>&#125;, <span class="string">''</span>, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// result </span></span><br><span class="line"><span class="string">"&#123;</span></span><br><span class="line"><span class="string">    "</span>name<span class="string">": "</span>煦涵<span class="string">",</span></span><br><span class="line"><span class="string">    "</span>age<span class="string">": 28,</span></span><br><span class="line"><span class="string">    "</span>male<span class="string">": true,</span></span><br><span class="line"><span class="string">    "</span>other<span class="string">": null</span></span><br><span class="line"><span class="string">&#125;"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">JSON</span>.stringify(&#123;<span class="string">"level1"</span>: &#123;<span class="string">"level2"</span>: &#123;<span class="string">"level3"</span>: &#123;<span class="string">"name"</span>: <span class="string">"煦涵"</span>&#125; &#125; &#125; &#125;, <span class="string">''</span>, <span class="string">'|---'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// result: 展示属性结构很直观</span></span><br><span class="line"><span class="string">"&#123;</span></span><br><span class="line"><span class="string">|---"</span>level1<span class="string">": &#123;</span></span><br><span class="line"><span class="string">|---|---"</span>level2<span class="string">": &#123;</span></span><br><span class="line"><span class="string">|---|---|---"</span>level3<span class="string">": &#123;</span></span><br><span class="line"><span class="string">|---|---|---|---"</span>name<span class="string">": "</span>煦涵<span class="string">"</span></span><br><span class="line"><span class="string">|---|---|---&#125;</span></span><br><span class="line"><span class="string">|---|---&#125;</span></span><br><span class="line"><span class="string">|---&#125;</span></span><br><span class="line"><span class="string">&#125;"</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>特殊情况<br>还记得上面的几种情况吧，当对象不是原始对象时，处理方式有所不同，比如正则表达式时，会返回空对象，日期对象时返回日期字符串;参看文档是，JSON.stringify发现参数对象有toJSON方法，就直接使用这个方法的返回值作为参数，而忽略原对象的其他参数。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"煦涵"</span>,</span><br><span class="line">    <span class="string">"age"</span>: <span class="number">28</span>,</span><br><span class="line">    <span class="string">"toJSON"</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name + <span class="string">'年龄是'</span> + <span class="keyword">this</span>.age + <span class="string">'岁'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// result:</span></span><br><span class="line"><span class="string">""</span>煦涵年龄是<span class="number">28</span>岁<span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 日期对象Date原型上包含toJSON 方法，`Date.prototype.toJSON ( key )` */</span></span><br><span class="line"><span class="keyword">var</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">date.toJSON();</span><br><span class="line"><span class="built_in">JSON</span>.stringify(date);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* RegExp 对象 JSON.stringify 默认会把正则转换成空对象，我们可以使用toJSON, 把正则表达式转换成字符串 */</span></span><br><span class="line"><span class="built_in">RegExp</span>.prototype.toJSON = <span class="built_in">RegExp</span>.prototype.toString;</span><br><span class="line"><span class="built_in">JSON</span>.stringify(<span class="regexp">/abc/g</span>)</span><br><span class="line"><span class="comment">// result</span></span><br><span class="line"><span class="string">""</span>/abc/g<span class="string">""</span></span><br></pre></td></tr></table></figure>


<h3 id="JSON-parse-text-reviver"><a href="#JSON-parse-text-reviver" class="headerlink" title="JSON.parse ( text [ , reviver ] )"></a>JSON.parse ( text [ , reviver ] )</h3><p>JSON.parse为 JSON.stringify的逆运算，转换时 text 必须符合JSON的语法格式， 不然会报错，reviver 参数 和 JSON.stringify 的参数 replacer类似， 但是遍历顺序和replacer相反。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">JSON</span>.parse(<span class="string">'&#123;"name":"煦涵","age":28,"male":true,"brother":["B1","B2","B3"],"parent":&#123;"father":&#123;"name":"name"&#125;,"mother":&#123;"name":"name"&#125;&#125;,"other":null&#125;'</span> )</span><br><span class="line"></span><br><span class="line"><span class="comment">/* result:</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    "name": "煦涵",</span></span><br><span class="line"><span class="comment">    "age" : 28,</span></span><br><span class="line"><span class="comment">    "male" : true,</span></span><br><span class="line"><span class="comment">    "brother": ["B1", "B2", "B3"],</span></span><br><span class="line"><span class="comment">    "parent": &#123;</span></span><br><span class="line"><span class="comment">        "father" : &#123;</span></span><br><span class="line"><span class="comment">            "name": "name"</span></span><br><span class="line"><span class="comment">        &#125;,</span></span><br><span class="line"><span class="comment">        "mother": &#123;</span></span><br><span class="line"><span class="comment">            "name": "name"</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    &#125;,</span></span><br><span class="line"><span class="comment">    "other": null</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">JSON</span>.parse(<span class="string">'&#123;"level1": &#123;"level2": &#123;"name": "煦涵"&#125; &#125; &#125;'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">key, value</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// level2 Object &#123;name: "煦涵"&#125;</span></span><br><span class="line">    <span class="comment">// level1 Object &#123;level2: Object&#125;</span></span><br><span class="line">    <span class="comment">// Object &#123;level1: Object&#125;</span></span><br><span class="line">    <span class="built_in">console</span>.log(key, value);</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// result</span></span><br><span class="line">&#123;<span class="string">"level1"</span>:&#123;<span class="string">"level2"</span>:&#123;<span class="string">"name"</span>:<span class="string">"煦涵"</span>&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="参考文档："><a href="#参考文档：" class="headerlink" title="参考文档："></a>参考文档：</h2><p><a href="http://www.ecma-international.org/ecma-262/5.1/#sec-15.12" target="_blank" rel="noopener">http://www.ecma-international.org/ecma-262/5.1/#sec-15.12</a><br><a href="https://github.com/douglascrockford/JSON-js/blob/master/json2.js" target="_blank" rel="noopener">https://github.com/douglascrockford/JSON-js/blob/master/json2.js</a><br><a href="http://www.json.org/" target="_blank" rel="noopener">http://www.json.org/</a></p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2017/04/30/JSON/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
        <li class="pagination-number">第 1 页 共 1 页</li>
    </ul>
</div>

</section>


                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2020 煦涵. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="https://avatars0.githubusercontent.com/u/5378965?s=460&amp;v=4" alt="作者的图片"/>
        
            <h4 id="about-card-name">煦涵</h4>
        
            <div id="about-card-bio"><p>因为热爱，所以坚持。</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Front-end Engineer</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Beijing
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-ogaxrurcpmycz7m6zn50p8mo6tatzjf3bim6ghv4axcaiqa908v5le39rcgp.min.js"></script>

<!--SCRIPTS END-->





    </body>
</html>
