
<!DOCTYPE html>
<html lang="zh-cn">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="煦涵驛">
    <title>分类: Web开发 - 煦涵驛</title>
    <meta name="author" content="煦涵">
    
        <meta name="keywords" content="WEB开发,前端开发,用户体验">
    
    
        <link rel="icon" href="https://zuojj.gitlab.io/assets/images/favicon.ico">
    
    
    <script type="application/ld+json">{}</script>
    <meta name="description" content="志不强者智不达">
<meta property="og:type" content="blog">
<meta property="og:title" content="煦涵驛">
<meta property="og:url" content="https://zuojj.gitlab.io/categories/Web%E5%BC%80%E5%8F%91/index.html">
<meta property="og:site_name" content="煦涵驛">
<meta property="og:description" content="志不强者智不达">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="煦涵">
<meta property="article:tag" content="WEB开发">
<meta property="article:tag" content="前端开发">
<meta property="article:tag" content="用户体验">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@https:&#x2F;&#x2F;twitter.com&#x2F;zuojj">
    
    
        
    
    
        <meta property="og:image" content="https://avatars0.githubusercontent.com/u/5378965?s=460&amp;v=4"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-n2lvfzsmwt2hvavjmplmv122pj2aihmergs7judkqfrhxgekspfyz63ftv4u.min.css">

    <!--STYLES END-->
    

    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="2">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/%20"
            aria-label=""
        >
            煦涵驛
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="打开链接: /#about"
            >
        
        
            <img class="header-picture" src="https://avatars0.githubusercontent.com/u/5378965?s=460&amp;v=4" alt="作者的图片"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="2">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="阅读有关作者的更多信息"
                >
                    <img class="sidebar-profile-picture" src="https://avatars0.githubusercontent.com/u/5378965?s=460&amp;v=4" alt="作者的图片"/>
                </a>
                <h4 class="sidebar-profile-name">煦涵</h4>
                
                    <h5 class="sidebar-profile-bio"><p>因为热爱，所以坚持。</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="首页"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">首页</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="分类"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">分类</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="标签"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">标签</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="归档"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">归档</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="关于"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">关于</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/zuojj"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="mailto:zuojj.com@gmail.com"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="邮箱"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">邮箱</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="2"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2017/09/02/%E5%BD%93%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91%E9%81%87%E4%B8%8A%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B1%9E%E6%80%A7%E7%BA%A7%E8%81%94%E5%8F%98%E9%87%8F/"
                            aria-label=": 当组件化开发遇上自定义属性级联变量"
                        >
                            当组件化开发遇上自定义属性级联变量
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2017-09-02T13:56:41+08:00">
	
		    9月 02, 2017
    	
    </time>
    
        <span>发布在 </span>
        
    <a class="category-link" href="/categories/Web%E5%BC%80%E5%8F%91/">Web开发</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>自2015年12月W3C发布<a href="https://www.w3.org/TR/css-variables/" target="_blank" rel="noopener">自定义属性级联变量</a>推荐性规范已经有一段时间了，今天本文首先会对自定义属性使用做一个基本的介绍，后面将主要讲述在我们日常组件开发中CSS自定义的应用。浏览器兼容性参见<a href="http://caniuse.com/#search=custom%20proper" target="_blank" rel="noopener">CSS Variables (Custom Properties)</a></p>
<h2 id="属性定义"><a href="#属性定义" class="headerlink" title="属性定义"></a>属性定义</h2><p>基本语法：–<custom-property-name>: <cutome-propery-value>，以“–”开头（为了和Sass/Less等预处理器变量进行区分），自定义属性名对大小写敏感，<code>--foo</code> 和 <code>--FOO</code> 会映射到不同的值。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-pseudo">:root</span> &#123;</span><br><span class="line">    <span class="attribute">--btn-color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--btn-color);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用自定义属性"><a href="#使用自定义属性" class="headerlink" title="使用自定义属性"></a>使用自定义属性</h2><p>基本语法：<css-property-name>: var(<custom-property-name>[,<declaration-value>]);此处括号的意思是如果<custom-property-name>没有指定值，则使用<declaration-value>值。这个扩展非常有用，比如我们做多皮肤主题时，可以使用此语法设置默认皮肤。</p>
<h3 id="CSS-自定义属性遵循-CSS-级联及继承规则"><a href="#CSS-自定义属性遵循-CSS-级联及继承规则" class="headerlink" title="CSS 自定义属性遵循 CSS 级联及继承规则"></a>CSS 自定义属性遵循 CSS 级联及继承规则</h3><ul>
<li>定义全局变量</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-pseudo">:root</span> &#123;</span><br><span class="line">    <span class="attribute">--global-variables</span>: <span class="string">'global-value'</span>;</span><br><span class="line">    <span class="attribute">--bg-color</span>: <span class="number">#f0f</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>定义组件局部变量</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.header</span> &#123;</span><br><span class="line">    <span class="attribute">--bg-color</span>: <span class="number">#f00</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">var</span>(--bg-color);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.main</span> &#123;</span><br><span class="line">    <span class="comment">/* use global variable --bg-color: #f0f */</span></span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">var</span>(--bg-color);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.footer</span> &#123;</span><br><span class="line">    <span class="attribute">--bg-color</span>: <span class="number">#00f</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">var</span>(--bg-color);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="循环依赖"><a href="#循环依赖" class="headerlink" title="循环依赖"></a>循环依赖</h3><ul>
<li>示例一：</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-pseudo">:root</span> &#123;</span><br><span class="line">  <span class="attribute">--a</span>: <span class="built_in">calc</span>(var(--b) + <span class="number">20px</span>);</span><br><span class="line">  <span class="attribute">--b</span>: <span class="built_in">calc</span>(var(--a) - <span class="number">20px</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* box的 width 和 height 仍为初始值，自定义属性无效 */</span></span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="built_in">var</span>(--a);</span><br><span class="line">    <span class="attribute">height</span>: <span class="built_in">var</span>(--b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>示例二：</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">    <span class="selector-pseudo">:root</span> &#123;</span></span><br><span class="line">        --font-size: 40px;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="css">    <span class="selector-class">.parent</span> &#123;</span></span><br><span class="line">        font-size: var(--font-size);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="css">    <span class="selector-class">.son</span> &#123;</span></span><br><span class="line">        --son: calc(var(--font-size) * 2);</span><br><span class="line"><span class="css">        <span class="comment">/* font-size: 80px */</span></span></span><br><span class="line">        font-size: var(--son);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="css">    <span class="selector-class">.grandson</span> &#123;</span></span><br><span class="line">        --font-size: calc(var(--son) * 2);</span><br><span class="line"><span class="css">        <span class="comment">/* font-size: 160px */</span></span></span><br><span class="line">        font-size: var(--font-size);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"parent"</span>&gt;</span></span><br><span class="line">    parent </span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"son"</span>&gt;</span></span><br><span class="line">        on </span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"grandson"</span>&gt;</span>grandson<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="多皮肤主题中的应用"><a href="#多皮肤主题中的应用" class="headerlink" title="多皮肤主题中的应用"></a>多皮肤主题中的应用</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">    <span class="selector-pseudo">:root</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">--default-color</span>: <span class="selector-id">#000</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    body &#123;</span><br><span class="line">        margin: 0;</span><br><span class="line"><span class="css">        <span class="selector-tag">color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">    <span class="selector-class">.header</span> &#123;</span></span><br><span class="line">        text-align: center;</span><br><span class="line">        background-color: var(--default-color);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">    <span class="selector-class">.main</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">    <span class="selector-class">.footer</span> &#123;</span></span><br><span class="line">        position: fixed;</span><br><span class="line">        left: 0;</span><br><span class="line">        bottom: 0;</span><br><span class="line">        width: 100%;</span><br><span class="line"><span class="css">        <span class="selector-tag">background</span>: <span class="selector-tag">linear-gradient</span>(<span class="selector-tag">to</span> <span class="selector-tag">bottom</span>, <span class="selector-id">#ccc</span>, <span class="selector-tag">var</span>(<span class="selector-tag">--default-color</span>));</span></span><br><span class="line">    &#125;</span><br><span class="line">    select &#123;</span><br><span class="line">        width: 100px;</span><br><span class="line">        height: 24px;</span><br><span class="line">        font-size: 14px;</span><br><span class="line">        line-height: 24px;</span><br><span class="line"><span class="css">        <span class="selector-tag">color</span>: <span class="selector-id">#333</span>;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">border</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#ccc</span>;</span></span><br><span class="line">        background-color: none;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">"header"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"theme-select"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"#000"</span> <span class="attr">selected</span>&gt;</span>Black<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"#f00"</span>&gt;</span>Red<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"#00f"</span>&gt;</span>Blue<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"main"</span>&gt;</span></span><br><span class="line">    Main</span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">footer</span> <span class="attr">class</span>=<span class="string">"footer"</span>&gt;</span></span><br><span class="line">    Footer</span><br><span class="line"><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">    <span class="comment">/* change theme */</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.querySelector(<span class="string">'#theme-select'</span>).addEventListener(<span class="string">'change'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.documentElement.style.setProperty(<span class="string">"--default-color"</span>, <span class="keyword">this</span>.value);</span></span><br><span class="line"><span class="actionscript">    &#125;, <span class="literal">false</span>);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="组件化开发中的应用"><a href="#组件化开发中的应用" class="headerlink" title="组件化开发中的应用"></a>组件化开发中的应用</h3><p>开发一个 Button 组件，并使用 CSS 自定义属性。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.btn-groups</span> &#123;</span></span><br><span class="line">        display: flex;</span><br><span class="line">        flex-wrap: wrap;</span><br><span class="line">        padding: 10px 5px;</span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#eee</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">    <span class="selector-class">.btn</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">--btnColor</span>: <span class="selector-id">#5eb5ff</span>;</span></span><br><span class="line">        border: 1px solid var(--btnColor);</span><br><span class="line">        color: var(--btnColor);</span><br><span class="line">        background-color: white;</span><br><span class="line">        padding: 10px 25px;</span><br><span class="line">        text-decoration: none;</span><br><span class="line">        font-family: "Output Sans";</span><br><span class="line">        font-weight: 600;</span><br><span class="line">        border-radius: 3px;</span><br><span class="line">        margin: 5px;</span><br><span class="line"><span class="css">        <span class="selector-tag">transition</span>: <span class="selector-tag">all</span> <span class="selector-class">.3s</span> <span class="selector-tag">ease</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">    <span class="selector-class">.btn-red</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">--btnColor</span>: <span class="selector-id">#ff6969</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">    <span class="selector-class">.btn-green</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">--btnColor</span>: <span class="selector-id">#7ae07a</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">    <span class="selector-class">.btn-gray</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">--btnColor</span>: <span class="selector-id">#555</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">    <span class="selector-class">.btn-purple</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">--btnColor</span>: <span class="selector-id">#ef34ef</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">    <span class="selector-class">.btn</span><span class="selector-pseudo">:hover</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line">        background-color: var(--btnColor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">    <span class="selector-class">.btn</span><span class="selector-pseudo">:active</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">opacity</span>: <span class="selector-class">.6</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"btn-groups"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">'javascript:void(0)'</span> <span class="attr">class</span>=<span class="string">'btn'</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">'javascript:void(0)'</span> <span class="attr">class</span>=<span class="string">'btn btn-red'</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">'javascript:void(0)'</span> <span class="attr">class</span>=<span class="string">'btn btn-green'</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">'javascript:void(0)'</span> <span class="attr">class</span>=<span class="string">'btn btn-gray'</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">'javascript:void(0)'</span> <span class="attr">class</span>=<span class="string">'btn btn-purple'</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="浏览器检测"><a href="#浏览器检测" class="headerlink" title="浏览器检测"></a>浏览器检测</h2><p>1.CSS @supports 检测</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@supports</span> ( (<span class="attribute">--a:</span> <span class="number">0</span>)) &#123;</span><br><span class="line">  <span class="comment">/* supported */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@supports</span> ( <span class="keyword">not</span> (<span class="attribute">--a:</span> <span class="number">0</span>)) &#123;</span><br><span class="line">  <span class="comment">/* not supported */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.javascript检测</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isSupported = <span class="built_in">window</span>.CSS &amp;&amp;</span><br><span class="line">    <span class="built_in">window</span>.CSS.supports &amp;&amp; <span class="built_in">window</span>.CSS.supports(<span class="string">'--a'</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (isSupported) &#123;</span><br><span class="line">  <span class="comment">/* supported */</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">/* not supported */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>通过上面内容，我们了解了CSS自定义属性的定义、语法、检测、应用、示例及与javascript交互，同时我们也了解到 CSS 自定义属性的优点。如果你还没有使用过 CSS 自定义属性，动手get起来吧。</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2017/09/02/%E5%BD%93%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91%E9%81%87%E4%B8%8A%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B1%9E%E6%80%A7%E7%BA%A7%E8%81%94%E5%8F%98%E9%87%8F/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2017/08/13/font-display/"
                            aria-label=": font-display"
                        >
                            font-display
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2017-08-13T13:53:17+08:00">
	
		    8月 13, 2017
    	
    </time>
    
        <span>发布在 </span>
        
    <a class="category-link" href="/categories/Web%E5%BC%80%E5%8F%91/">Web开发</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>当我们在前端开发中使用自定义字体时，会遇到字体加载慢影响用户体验的情况，今天本篇文章来介绍 <code>font-display</code> 属性，该属性定义了浏览器加载和显示自定义字体文件的方式。开始介绍 <code>font-display</code> 属性前，我们来看看浏览器渲染字体有哪些差异：</p>
<table>
<thead>
<tr>
<th>Browser</th>
<th>Timeout</th>
<th>Fallback</th>
<th>Swap</th>
</tr>
</thead>
<tbody><tr>
<td>Chrome 35+</td>
<td>3 seconds</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr>
<td>Opera</td>
<td>3 seconds</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr>
<td>Firefox</td>
<td>3 seconds</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr>
<td>IE</td>
<td>0 seconds</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr>
<td>Safari</td>
<td>No timeout</td>
<td>N/A</td>
<td>N/A</td>
</tr>
</tbody></table>
<p>Chrome、Opera、Firefox 浏览器超时时间为 3 秒，超时后将使用后备字体渲染。如果字体下载成功，将替换后备字体，重新渲染文本。在 IE 浏览器会立即渲染文本，如果字体未下载完成，使用后备字体立即渲染，如果字体下载成功，使用后备字体重新渲染。Safari浏览器没有超时行为，不知道后备字体和字体替换。</p>
<h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: <span class="string">'YourWebFont'</span>,</span><br><span class="line">    src: <span class="built_in">url</span>(<span class="string">'https://fonts.gstatic.com/s/baloobhai/v1/xxxx.woff2'</span>) <span class="built_in">format</span>(<span class="string">'woff2'</span>)</span><br><span class="line">         <span class="built_in">url</span>(<span class="string">'https://fonts.gstatic.com/s/baloobhai/v1/xxxx.woff'</span>) <span class="built_in">format</span>(<span class="string">'woff'</span>);</span><br><span class="line">    <span class="attribute">font-display</span>: swap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="为什么用-font-display"><a href="#为什么用-font-display" class="headerlink" title="为什么用 font-display"></a>为什么用 font-display</h2><ul>
<li>决定是否使用后备字体显示字体或者字体下载过程中将其隐藏</li>
<li>控制字体加载后你想要做什么，即继续显示后备字体或者用自定义字体替换。当然，你也可以在每个元素上进行设置</li>
<li>可以为每一个字体指定下载超时值，甚至可以应用到某个指定元素</li>
<li>有效的提升用户体验，以免文字加载太慢影响用户使用和操作。</li>
</ul>
<h2 id="font-display-可取值"><a href="#font-display-可取值" class="headerlink" title="font-display 可取值"></a>font-display 可取值</h2><ul>
<li>auto: 默认值，指定浏览器使用默认方式加载字体，现在大多数浏览器使用默认策略和 block 相似。</li>
<li>block: 指定浏览器要隐藏的文本，直到字体完全下载完成。 更准确地说，浏览器用无形占位符绘制文本，然后在字体加载完后立即与自定义字体交换。 这也被称为 “Flash of Invisible Text” 或者 “FOIT”。</li>
<li>swap: 指定浏览器使用后备字体渲染文本，直到字体文件下载完成。这也被称为 “flash of unstyled text” 或者 “FOUT”</li>
<li>fallback: 该状态是 auto 和 swap 的一个中间状态，浏览器隐藏文本大约 100ms, 如果字体没有下载完成，则使用后备文本字体渲染，知道自定义字体下载完成。</li>
<li>optinal: 与 fallback 类似，如果字体能够为页面效果增色不少，但并非特别重要时，使用 optional 正好。使用 optional 时，将由浏览器来决定是否开始下载字体。可以不下载，也可以给予字体较低的优先级，一切取决于浏览器是否认为对用户最有利。当<strong>用户处于弱网络</strong>下，这是非常有用的，下载字体可能并不是对资源最好的利用。</li>
</ul>
<h2 id="浏览器支持"><a href="#浏览器支持" class="headerlink" title="浏览器支持"></a>浏览器支持</h2><p>Chrome 60+, Opera 47+ 已经支持 <code>font-display</code> 属性</p>
<h2 id="不支持-font-display-使用-Font-Loading-API"><a href="#不支持-font-display-使用-Font-Loading-API" class="headerlink" title="不支持 font-display 使用 Font Loading API"></a>不支持 font-display 使用 Font Loading API</h2><p><a href="https://drafts.csswg.org/css-font-loading/" target="_blank" rel="noopener">W3C Font Loading API Draft</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> html = <span class="built_in">document</span>.documentElement;</span><br><span class="line"><span class="keyword">if</span>(<span class="string">"fontDisplay"</span> <span class="keyword">in</span> <span class="built_in">document</span>.body.style === <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="string">'fonts'</span> <span class="keyword">in</span> <span class="built_in">document</span>) &#123;</span><br><span class="line">        <span class="built_in">document</span>.fonts.load(<span class="string">'1em Open Sans Regular'</span>);</span><br><span class="line">        <span class="built_in">document</span>.fonts.ready.then(<span class="function"><span class="keyword">function</span>(<span class="params">fontFaceSet</span>) </span>&#123;</span><br><span class="line">            html.className += <span class="string">' fonts-loaded'</span>;</span><br><span class="line">        &#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            html.className += <span class="string">' fonts-failed'</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2017/08/13/font-display/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2017/07/23/overflow/"
                            aria-label=": overflow"
                        >
                            overflow
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2017-07-23T13:51:13+08:00">
	
		    7月 23, 2017
    	
    </time>
    
        <span>发布在 </span>
        
    <a class="category-link" href="/categories/Web%E5%BC%80%E5%8F%91/">Web开发</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>在 [CSS1.0]规范中，当容器中的内容超过容器的边界时，会导致溢出内容与其他的内容重叠，被认为是开发者的错误。[CSS2.1]中引入了  <code>overflow</code> 属性，用来控制溢出内容的显示方式，是隐藏、裁剪还是自动处理。<a href="https://www.w3.org/TR/css-overflow-3/" target="_blank" rel="noopener">CSS Overflow Module Level 3</a>引入了溢出隐藏的标准，更全面的定义了溢出的处理方式。overflow 有两种类型，一种是 <code>text-shadow</code>、<code>box-shadow</code>、<code>boder-images</code>、<code>text-decoration</code> 形成的 <strong>ink overflow</strong>，另一种就是我们常说的<strong>scrollable overflow</strong>。本篇内容将从定义到实践应用来深入 <code>overflow</code> 属性。</p>
<h2 id="适用元素"><a href="#适用元素" class="headerlink" title="适用元素"></a>适用元素</h2><ul>
<li>block containers [CSS2.1]</li>
<li>flex containers  [CSS3-FLEXBOX]</li>
<li>grid containers  [CSS3-GRID-LAYOUT]</li>
</ul>
<h2 id="可取值"><a href="#可取值" class="headerlink" title="可取值"></a>可取值</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">    <span class="attribute">overflow</span>: visible | hidden | clip | scroll | auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="visible"><a href="#visible" class="headerlink" title="visible"></a>visible</h3><p>默认值，内容超出容器边界，会产生溢出，和其他内容重叠，该容器不是一个scroll container，运行实例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.container</span> &#123;</span></span><br><span class="line">        width: 100px;</span><br><span class="line">        height: 100px;</span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#f0f</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span> <span class="attr">id</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    至少有十年我不曾流泪</span><br><span class="line">    至少有十首歌给我安慰</span><br><span class="line">    可现在我会莫名的心碎</span><br><span class="line">    当我想你的时候</span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="hidden"><a href="#hidden" class="headerlink" title="hidden"></a>hidden</h3><p>该属性内容超出容器边界，不会溢出，但是可以使用 <code>javascript</code> 脚本控制滚动，该容器仍然是一个 scroll container，查看下面示例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.container</span> &#123;</span></span><br><span class="line">        width: 100px;</span><br><span class="line">        height: 100px;</span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#f0f</span>;</span></span><br><span class="line">        overflow: hidden;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span> <span class="attr">id</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    至少有十年我不曾流泪</span><br><span class="line">    至少有十首歌给我安慰</span><br><span class="line">    可现在我会莫名的心碎</span><br><span class="line">    当我想你的时候</span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">    (<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> container = <span class="built_in">document</span>.querySelector(<span class="string">'#container'</span>);</span></span><br><span class="line">        container.scrollTop = 80;</span><br><span class="line">    &#125;)();</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="clip"><a href="#clip" class="headerlink" title="clip"></a>clip</h3><p>该属性和 <code>overflow: hidden</code> 很相似，它可以按 clip 区域进行裁切，但是和hidden 属性不同的是该属性禁止通过 <code>javascript</code> 脚本滚动，该容器不是一个 scrooll container，这个属性现在浏览器还没有支持。</p>
<h3 id="scroll"><a href="#scroll" class="headerlink" title="scroll"></a>scroll</h3><p>该属性会默认产生滚动条，内容不会溢出容器；用户可以操作滚动条进行滚动，也可以通过脚本滚动。但是在打印（print）模式时，可能会打印溢出的内容。</p>
<h3 id="auto"><a href="#auto" class="headerlink" title="auto"></a>auto</h3><p>该属性会随容器内容溢出情况，自动判断是否出现滚动条；</p>
<blockquote>
<p>PS：如果该块级容器的 overflow 属性值不是 visible，会默认为它的内容创建一个新的 ”块级格式化上下文“（BFC）。</p>
</blockquote>
<h2 id="overflow-应用场景"><a href="#overflow-应用场景" class="headerlink" title="overflow 应用场景"></a>overflow 应用场景</h2><ol>
<li><p>常见容器溢出处理，并可以通过设置水平（overflow-x）和垂直（overflow-y）方向上的个性化处理</p>
</li>
<li><p>两栏布局，在此布局中经常使用 overflow 来触发 BFC</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.container</span> &#123;</span></span><br><span class="line">        width: 100px;</span><br><span class="line">        height: 100px;</span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#f0f</span>;</span></span><br><span class="line">        overflow: hidden;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="css">    <span class="selector-class">.fr</span> &#123;</span></span><br><span class="line">        float: right;</span><br><span class="line">        width: 50px;</span><br><span class="line">        height: 50px;</span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#f00</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span> <span class="attr">id</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"fr"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span></span><br><span class="line">        至少有十年我不曾流泪</span><br><span class="line">        至少有十首歌给我安慰</span><br><span class="line">        可现在我会莫名的心碎</span><br><span class="line">        当我想你的时候</span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面实例是我们最常见的文字环绕，如果我们增加如下 css，结果会变成两栏布局：</p>
</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.content</span> &#123;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>清除浮动<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.container</span> &#123;</span></span><br><span class="line">        width: 100px;</span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#f0f</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="css">    <span class="selector-class">.fl</span> &#123;</span></span><br><span class="line">        float: left;</span><br><span class="line">        width: 40px;</span><br><span class="line">        height: 50px;</span><br><span class="line">        overflow: hidden;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="css">    <span class="selector-class">.fr</span> &#123;</span></span><br><span class="line">        float: right;</span><br><span class="line">        width: 50px;</span><br><span class="line">        height: 50px;</span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#f00</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span> <span class="attr">id</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"fr"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"fl"</span>&gt;</span></span><br><span class="line">        至少有十年我不曾流泪</span><br><span class="line">        至少有十首歌给我安慰</span><br><span class="line">        可现在我会莫名的心碎</span><br><span class="line">        当我想你的时候</span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
预览上面代码，你会发现 container 容器的高度为0，当你给 container 设置 <code>overflow: hidden</code> 时，会创建一个新的 块级格式化上下文，新的块级上下文可以包裹浮动流，从而不会引起容器高度塌陷，也就是说包含块会把浮动元素的高度也计算在内，所以不用清除浮动来撑起高度。关于清除浮动原理及BFC会在后面的文章中讲到，请持续关注。</li>
</ol>
<p>感谢您的阅读</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2017/07/23/overflow/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2017/07/15/line-clamp/"
                            aria-label=": line-clamp"
                        >
                            line-clamp
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2017-07-15T13:52:13+08:00">
	
		    7月 15, 2017
    	
    </time>
    
        <span>发布在 </span>
        
    <a class="category-link" href="/categories/Web%E5%BC%80%E5%8F%91/">Web开发</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>在日常前端开发需求中经常会有限制文本行数的需求，尤其在列表、图文混排等需求中，当需求是单行文本溢出时，我们可以选择使用 <code>text-overflow</code> 属性，当有多行文本需求时，我们可能首先想到使用 <code>javascript</code> 来处理，本文将和大家一起来认识一个新的 CSS 属性 <code>line-clamp</code>，这个属性现在是非标准属性，旨在解决多行文本截断问题，使用该属性时，有很多需要注意的地方，下面将一一道来。</p>
<h2 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h2><p>1.ellipsis支持</p>
<p>这个功能在我们处理多行文本时，是的确有益的，我们可以根据我们的需求来设置任意的行数，来适应我们的需求，并显示省略号溢出提示。</p>
<p>2.友好的向后兼容</p>
<p>我们可以使用 CSS 条件判断 <code>@support(line-clamp: number) {}</code> 来做向后兼容处理，比如如下代码：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.line-clamp</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">3.6em</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">1.2em</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ccc</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">3px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.line-clamp</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">"..."</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">1.2em</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">1.2em</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">3px</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: right;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(to right, rgba(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>), <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">1</span>) <span class="number">50%</span>);</span><br><span class="line">&#125;</span><br><span class="line">@supports(-webkit-line-clamp: 3) &#123;</span><br><span class="line">    <span class="selector-class">.line-clamp</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: -webkit-box;</span><br><span class="line">        <span class="attribute">-webkit-line-clamp</span>: <span class="number">3</span>;</span><br><span class="line">        <span class="attribute">-webkit-box-orient</span>: vertical;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.line-clamp</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: none;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="缺点及注意事项"><a href="#缺点及注意事项" class="headerlink" title="缺点及注意事项"></a>缺点及注意事项</h2><p>1.浏览器支持</p>
<p>IE、Microsoft Edge、Firefox、Opera Mini 不支持 <code>-webkit-line-clamp</code> ，Webkit 内核的浏览器需要使用 <code>-webkit</code> 前缀。详细请参考<a href="http://caniuse.com/#search=line-clamp" target="_blank" rel="noopener">CanIUse:line-clamp: http://caniuse.com/#search=line-clamp</a></p>
<p>2.属性依赖</p>
<p>需要依赖 <code>overflow: hidden</code>、<code>display: -webkit-box</code>、<code>-webkit-box-orient: vertical</code>，如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.line-clamp</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: -webkit-box;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">-webkit-box-orient</span>: vertical;</span><br><span class="line">    <span class="attribute">-webkit-line-clamp</span>: <span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3.不支持 direction</p>
<p>当设置文本方向为 <code>direction: rtl</code> 时不起作用，<code>-webkit-line-clamp</code> 会被忽略。</p>
<p>4.奇怪的断点处理</p>
<p><code>-webkit-line-clamp</code> 文本断行情况，并不是和之前[煦涵说CSS：文本断行]一文中的 <strong>软性断行机会点</strong> 情况一致， 它常常在某个词的中间断行，比如 “I am a fashion man” 经过设置 <code>line-clamp</code> 后，情况可能是 “I am a fash…”，这样的坏处时，可能会引起文本的歧义，特别是在文章标题等重要内容处理需求时。</p>
<p>5.省略号不可用其他字符替代</p>
<p>该属性不像 <code>text-overflow</code> 在 Firefox 浏览器中可以使用特殊字符替换（当然现在标准还么有支持，支持情况也不容乐观）。</p>
<p>6.无空格文本不支持</p>
<p>当我们在一段文本中无空格时，使用 <code>-webkit-line-clamp</code> 不会生效。</p>
<p>7.不同语言 ellipsis 语义不同</p>
<p>在不同语言中 ellipsis 对应的语义不同，比如波兰语中，省略号表示语音的中断或者暂停，而在CJK语言中，省略号表示语句没有说完，更常见的是省略号应该是文本行垂直居中的，但是现在 <code>line-clamp</code> 属性是不支持的。更多不同请参考<a href="https://en.wikipedia.org/wiki/Ellipsis" target="_blank" rel="noopener">Wikit Ellipsis: https://en.wikipedia.org/wiki/Ellipsis</a>。</p>
<h2 id="Opera-独特兼容方案"><a href="#Opera-独特兼容方案" class="headerlink" title="Opera 独特兼容方案"></a>Opera 独特兼容方案</h2><p>Opera浏览器对此属性在未来支持如何如何仍尚未可知。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.line-clamp</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">3.6em</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">text-overflow</span>: -o-ellipsis-lastline;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Javascript-兼容方案"><a href="#Javascript-兼容方案" class="headerlink" title="Javascript 兼容方案"></a>Javascript 兼容方案</h2><p>1.简单实现方案：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> clamps = <span class="built_in">document</span>.querySelectorAll(<span class="string">'.line-clamp'</span>);</span><br><span class="line">[].forEach.call(clamps, (item, index) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> clientH = item.clientHeight;</span><br><span class="line">    <span class="keyword">while</span> (item.scrollHeight &gt; clientH) &#123;</span><br><span class="line">        item.textContent = item.textContent.replace(<span class="regexp">/\W*\s\S*$/</span>, <span class="string">'...'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>2.建议的实现方案</p>
<ul>
<li><a href="https://github.com/josephschmitt/Clamp.js" target="_blank" rel="noopener">clamp.js</a> </li>
<li><a href="https://github.com/ftlabs/ftellipsis/blob/master/lib/index.js" target="_blank" rel="noopener">ftellipsis</a></li>
</ul>
<p>简单的实现方案，不建议采用，如果需要使用在生产环境中，建议使用以上两个方案，其基本实现思路根据行高、行数、容器高度进行判断，进行截断处理。</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2017/07/15/line-clamp/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2017/07/08/text-overflow/"
                            aria-label=": text-overflow"
                        >
                            text-overflow
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2017-07-08T13:49:31+08:00">
	
		    7月 08, 2017
    	
    </time>
    
        <span>发布在 </span>
        
    <a class="category-link" href="/categories/Web%E5%BC%80%E5%8F%91/">Web开发</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p><a href="https://www.w3.org/TR/css-ui-3/#text-overflow" target="_blank" rel="noopener">text-overflow</a> 属性常用来处理文本溢出时剪切文本，常用的取值有 clip 、ellipsis 、inherit; 常见的文本溢出处理 CSS：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.ellipsis</span> &#123;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">    <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h2><ol>
<li>该元素必须为 <code>display:block</code> 或者 <code>display:inline-block</code> 元素，需要设置宽度来控制文本被溢出。</li>
<li>该元素必须设置 <code>overflow: hidden | scroll | auto</code>。</li>
<li>文本溢出方向依赖 <code>direction: rtl | ltr</code> 属性。</li>
<li>整行溢出依赖 <code>white-space: nowrap</code> 属性。</li>
</ol>
<h2 id="可取值"><a href="#可取值" class="headerlink" title="可取值"></a>可取值</h2><h3 id="clip"><a href="#clip" class="headerlink" title="clip"></a>clip</h3><p>默认值，设置该值时文本会被裁切。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.to-clip</span> &#123;</span><br><span class="line">    <span class="attribute">text-overflow</span>: clip;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ellipsis"><a href="#ellipsis" class="headerlink" title="ellipsis"></a>ellipsis</h3><p>设置改属性文本溢出时会显示省略号。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.to-ellipsis</span> &#123;</span><br><span class="line">    <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="自定义字符串"><a href="#自定义字符串" class="headerlink" title="自定义字符串"></a>自定义字符串</h2><p>可以给text-overflow 设置溢出自定义字符串，现在只有 Firefox 浏览器支持</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.custom</span> &#123;</span><br><span class="line">    <span class="attribute">text-overflow</span>: <span class="string">"fedlab"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="两个属性值"><a href="#两个属性值" class="headerlink" title="两个属性值"></a>两个属性值</h2><p>两个属性值语法，左右方向溢出，设置 <code>text-align: center</code>， 显示中间部分文本，现在只有Firefox支持。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.double</span> &#123;</span><br><span class="line">    <span class="attribute">text-overflow</span>: ellipsis ellipsis;</span><br><span class="line">    <span class="comment">/* 两边溢出 */</span></span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>PS：自定字符串及两个属性值情况，都有被遗弃的风险，在生产环境中慎用，目前只在 firefox 中支持。</p>
</blockquote>
<h2 id="兼容"><a href="#兼容" class="headerlink" title="兼容"></a>兼容</h2><ul>
<li>IE8/9浏览器 input[type=text] 元素上无效</li>
<li>Chrome/IE 浏览器 select 元素上无效</li>
<li>Opera 浏览器加前缀兼容 <code>-o-text-overflow</code></li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2017/07/08/text-overflow/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2017/06/21/word-wrap/"
                            aria-label=": word-wrap"
                        >
                            word-wrap
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2017-06-21T13:47:34+08:00">
	
		    6月 21, 2017
    	
    </time>
    
        <span>发布在 </span>
        
    <a class="category-link" href="/categories/Web%E5%BC%80%E5%8F%91/">Web开发</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>根据 W3C 的 <a href="https://drafts.csswg.org/css-text/" target="_blank" rel="noopener">CSS Text Module Level 3</a> 文件来看，在网页中文本断行的规则通常是断在 <code>软性断行机会点</code>（Soft Wrap Oppportunity）。各种标点符号和空白通常都是一个断行机会点。这对英文来说很方便，因为英文中每个单字都会以空白分隔开。无论是断在空白或者标点符号，都不会影响一个单字被完整呈现。但是对于 <code>CJK</code>（中日韩）来说，每个字都是断行机会点。本期内容和大家一起学习CSS断行相关的属性 <code>word-break</code>、<code>word-wrap</code>。</p>
<h2 id="word-break"><a href="#word-break" class="headerlink" title="word-break"></a>word-break</h2><p>该属性指定字母之间的“软性断行机会点”，何为软性断行机会点，即断行发生在断行机会点处。word-break 可取值为 normal | break-all | keep-all。只在 <code>white-space</code>属性值运行断行时生效。</p>
<ol>
<li>normal，不同字体根据下面自定义规则断行<ul>
<li>CJK可以在任何一个CJK字体后断行；</li>
<li>non-CJK会在半角空格或者连字符(-)位置自动断行，不会在长单词的中间断行；</li>
<li>CJK中包含non-CJK:non-CJK部分按 non-CJK情况处理进行断行处理；</li>
<li>CJK中含有标点符号时，浏览器不会让标点符号位于一个行的行首，会使标点符号和前一个字符组成一个整体进行断行；</li>
</ul>
</li>
<li>break-all，在任意的软性断行机会点处断行<ul>
<li>允许词内断行</li>
</ul>
</li>
<li>keep-all，禁止词内断行<ul>
<li>non-CJK与normal属性相同</li>
<li>IE浏览器中CJK在半空格、连接符或者任何标点符号处换行</li>
<li>Chrome &amp; Safari不支持该属性(使用默认换行)</li>
</ul>
</li>
<li>break-word，非官方属性<ul>
<li>该属性只在支持 Webkit/Blink 为内核的浏览器支持，比如Chrome、Safari</li>
<li>该属性效果和下面讲到的 <code>word-wrap: break-word</code> 相同</li>
</ul>
</li>
</ol>
<p>引用 W3C 文档中的例子：</p>
<blockquote>
<p>Here’s a mixed-script sample text:</p>
<p>这是一些汉字, and some Latin, و کمی نوشتن عربی,<br>และตัวอย่างการเขียนภาษาไทย.<br>The break-points are determined as follows (indicated by ‘·’):</p>
<p>word-break: normal<br>这·是·一·些·汉·字,·and·some·Latin,·و·کمی·نوشتن·عربی,·<br>และ·ตัวอย่าง·การเขียน·ภาษาไทย.<br>word-break: break-all<br>这·是·一·些·汉·字,·a·n·d·s·o·m·e·L·a·t·i·n,·و·ﮐ·ﻤ·ﻰ·ﻧ·ﻮ·ﺷ·ﺘ·ﻦ·ﻋ·ﺮ·ﺑ·ﻰ,·<br>แ·ล·ะ·ตั·ว·อ·ย่·า·ง·ก·า·ร·เ·ขี·ย·น·ภ·า·ษ·า·ไ·ท·ย.<br>word-break: keep-all<br>这是一些汉字,·and·some·Latin,·و·کمی·نوشتن·عربی,·<br>แและ·ตัวอย่าง·การเขียน·ภาษาไทย.</p>
</blockquote>
<h2 id="word-wrap"><a href="#word-wrap" class="headerlink" title="word-wrap"></a>word-wrap</h2><p>该属性指定是否可以在单词内任意断开，以防止在另外不可破坏的字符串太长而不能放置在行框内而造成溢出。只在 <code>white-space</code>属性值运行断行时生效。支持所有浏览器。可取值为 normal | break-word。</p>
<ol>
<li>normal<ul>
<li>在半空格、连接符位置处断行；</li>
</ul>
</li>
<li>break-word<ul>
<li>如果行中没有其他可接受的断点，则一个不可破坏的“单词”可能会在任意点断开；</li>
</ul>
</li>
</ol>
<h2 id="实例对比"><a href="#实例对比" class="headerlink" title="实例对比"></a>实例对比</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box keepall"</span>&gt;</span></span><br><span class="line">自身都带有自动换行功能啊，AAAAAA BBBBBBBBBBBBB,CCCCCCCCC，的右端自动换行。</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">此例中注意keep-all在不同浏览器中的兼容，特殊符号处的换行！</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box breakall"</span>&gt;</span></span><br><span class="line">自身都带有自动换行功能啊，AAAAAA BBBBBBBBBBBBB,CCCCCCCCC，的右端自动换行。</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">此例中注意逗号的位置!</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box breakword"</span>&gt;</span></span><br><span class="line">自身都带有自动换行功能啊，AAAAAA BBBBBBBBBBBBB,CCCCCCCCC，的右端自动换行。</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;style type="text/css"&gt;</span><br><span class="line">    <span class="selector-class">.box</span>&#123;<span class="attribute">width</span>:<span class="number">100px</span>;<span class="attribute">height</span>:<span class="number">100px</span>;<span class="attribute">border</span>:<span class="number">2px</span> solid <span class="number">#f00</span>;<span class="attribute">color</span>:<span class="number">#333</span>;<span class="attribute">font</span>:<span class="number">12px</span> arial;<span class="attribute">margin-bottom</span>:<span class="number">10px</span>;&#125;</span><br><span class="line">    <span class="selector-class">.keepall</span>&#123;<span class="attribute">word-break</span>:keep-all;&#125;</span><br><span class="line">    <span class="selector-class">.breakall</span>&#123;<span class="attribute">word-break</span>:break-all;&#125;</span><br><span class="line">    <span class="selector-class">.breakword</span>&#123;<span class="attribute">word-wrap</span>:break-word;&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
                    
                        


                    
                    
                        <p>
                            <a
                                href="/2017/06/21/word-wrap/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2017/06/13/Babel/"
                            aria-label=": Babel"
                        >
                            Babel
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2017-06-13T12:56:01+08:00">
	
		    6月 13, 2017
    	
    </time>
    
        <span>发布在 </span>
        
    <a class="category-link" href="/categories/Web%E5%BC%80%E5%8F%91/">Web开发</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p><a href="http://babeljs.io/" target="_blank" rel="noopener">Babel</a>，下一代javascript编译器，当前版本 <code>v2.4.0</code> ，它可以处理ES6的所有新语法，并内置了React JSX扩展及Flow类型注解支持，如果对Flow不是很了解可以查看FED实验室微信公众号文章<a href="https://segmentfault.com/a/1190000009639356" target="_blank" rel="noopener">煦涵说Flow</a>。</p>
<p>Babel与JavaScript技术委员会（TC39）始终保持着高度一致，能够在ECMAScript新特性标准化之前为开发者提供现实可用的转码编译实现，以在ECMAScript规范最后定稿前获得来自世界各地开发者更多的反馈，从而间接推动了javascript的发展以及开发者在项目中尝试使用新技术。因此建议大家开始使用 Babel。</p>
<h2 id="Babel-配置文件-babelrc"><a href="#Babel-配置文件-babelrc" class="headerlink" title="Babel 配置文件 .babelrc"></a>Babel 配置文件 <code>.babelrc</code></h2><p>学习和使用Babel的<strong>第一步</strong>，配置 <code>.babelrc</code> 文件，该文件存放到项目根目录下，用来设置 Babel 的转码规则和插件。基本格式如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"presets"</span>: [],</span><br><span class="line">  <span class="string">"plugins"</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://babeljs.io/docs/plugins/#presets" target="_blank" rel="noopener">presets</a>的规则集如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># replaces es2015, es2016, es2017, latest</span></span><br><span class="line">$ yarn add babel-preset-env --dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># es2015</span></span><br><span class="line">$ yarn add babel-preset-es2015 --dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># es2016</span></span><br><span class="line">$ yarn add babel-preset-es2016 --dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># es2017 </span></span><br><span class="line">$ yarn add babel-preset-es2017 --dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># react</span></span><br><span class="line">$ yarn add babel-preset-react --dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># flow</span></span><br><span class="line">$ yarn add babel-preset-flow --dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># The TC39 categorizes proposals into the following stages:</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># Stage 0 - Strawman: just an idea, possible Babel plugin.</span></span><br><span class="line"><span class="comment"># Stage 1 - Proposal: this is worth working on.</span></span><br><span class="line"><span class="comment"># Stage 2 - Draft: initial spec.</span></span><br><span class="line"><span class="comment"># Stage 3 - Candidate: complete spec and initial browser implementations.</span></span><br><span class="line"><span class="comment"># Stage 4 - Finished: will be added to the next yearly release.</span></span><br><span class="line"><span class="comment"># For more information, be sure to check out the current TC39 proposals and its process document.</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># The TC39 stage process is also explained in detail across a few posts by Yehuda Katz (@wycatz) over at thefeedbackloop.xyz: # Stage 0 and 1, Stage 2, Stage 3, and Stage 4 coming soon.</span></span><br><span class="line"></span><br><span class="line">$ yarn add babel-preset-stage-x --dev</span><br></pre></td></tr></table></figure>
<p><a href="https://babeljs.io/docs/plugins/#transform-plugins" target="_blank" rel="noopener">plugins</a>插件集合很多。</p>
<p>新建一个配置文件 <code>.babelrc</code>，并增加如下代码，以供我们下面调试使用:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新建配置文件.babelrc，并添加如下内容</span></span><br><span class="line"><span class="comment"># &#123;</span></span><br><span class="line"><span class="comment">#   "presets": ["es2015"],</span></span><br><span class="line"><span class="comment">#   "plugins": []</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line">$ touch .babelrc</span><br><span class="line"><span class="comment"># 安装 babel-preset-es2015</span></span><br><span class="line">$ yarn add babel-preset-es2015 --dev</span><br></pre></td></tr></table></figure>

<h2 id="安装和使用-Babel"><a href="#安装和使用-Babel" class="headerlink" title="安装和使用 Babel"></a>安装和使用 Babel</h2><blockquote>
<p>ps: 本文将使用Yarn来安装依赖相关npm包，如果不了解Yarn的欢迎阅读公众号专栏<a href="https://segmentfault.com/a/1190000009626901" target="_blank" rel="noopener">煦涵说Yarn</a>。</p>
</blockquote>
<h3 id="命令行方式运行-babel-cli"><a href="#命令行方式运行-babel-cli" class="headerlink" title="命令行方式运行 babel-cli"></a>命令行方式运行 babel-cli</h3><p><code>babel-cli</code> 的 CLI 是一种在命令行下使用 Babel 编译文件的简单方法。</p>
<h4 id="全局安装"><a href="#全局安装" class="headerlink" title="全局安装"></a>全局安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局安装</span></span><br><span class="line">$ yarn global add babel-cli</span><br></pre></td></tr></table></figure>

<p>新建一个source.js文件，内容如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">arr = arr.map(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> item * index;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(arr);</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 输出结果到控制台</span></span><br><span class="line">$ babel source.js</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果到文件</span></span><br><span class="line">$ babel source.js --out-file dist.js</span><br><span class="line">or </span><br><span class="line">$ babel source.js -o dist.js</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果到目录</span></span><br><span class="line">$ babel /src --out-dir /dist</span><br><span class="line">or </span><br><span class="line">$ babel /src -d /dist</span><br></pre></td></tr></table></figure>

<h4 id="项目内安装-局部安装"><a href="#项目内安装-局部安装" class="headerlink" title="项目内安装(局部安装)"></a>项目内安装(局部安装)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 初始化一个项目package.json</span></span><br><span class="line">$ mkdir first-babel-proj</span><br><span class="line">$ <span class="built_in">cd</span> first-babel-proj</span><br><span class="line">$ yarn init </span><br><span class="line">$ yarn add babel-cli --dev</span><br></pre></td></tr></table></figure>
<p>修改package.json，添加如下文本</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "name": "babel-proj",</span><br><span class="line">  "version": "1.0.0",</span><br><span class="line">  "main": "index.js",</span><br><span class="line">  "license": "MIT",</span><br><span class="line">  "devDependencies": &#123;</span><br><span class="line">    "babel-cli": "^6.24.1"</span><br><span class="line">  &#125;,</span><br><span class="line"><span class="addition">+  "scripts": &#123;</span></span><br><span class="line"><span class="addition">+   "build": "babel src -d dist"</span></span><br><span class="line"><span class="addition">+  &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yarn run build</span><br></pre></td></tr></table></figure>

<h3 id="require方式运行-babel-register"><a href="#require方式运行-babel-register" class="headerlink" title="require方式运行 babel-register"></a>require方式运行 babel-register</h3><blockquote>
<p>ps: 这种方法并不适合正式产品环境使用。 在部署到生成环境之前预先编译会更好。 不过用在构建脚本或是其他本地运行的脚本中是非常合适的。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yarn add babel-register --dev</span><br></pre></td></tr></table></figure>
<p>新建compile.js文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'babel-register'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'./src/source.js'</span>);</span><br></pre></td></tr></table></figure>
<p>运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node compile.js</span><br></pre></td></tr></table></figure>
<p>运行结果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ [0, 2, 6, 12]</span><br></pre></td></tr></table></figure>

<h3 id="编程方式运行-babel-core"><a href="#编程方式运行-babel-core" class="headerlink" title="编程方式运行 babel-core"></a>编程方式运行 babel-core</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yarn add babel-core --dev</span><br></pre></td></tr></table></figure>
<p>字符串形式的 JavaScript 代码可以直接使用 <code>babel.transform</code> 来编译。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">babel.transform(<span class="string">"code();"</span>, options);</span><br><span class="line"><span class="comment">// =&gt; &#123; code, map, ast &#125;</span></span><br></pre></td></tr></table></figure>

<p>如果是文件的话，可以使用异步 api：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">babel.transformFile(<span class="string">"filename.js"</span>, options, <span class="function"><span class="keyword">function</span>(<span class="params">err, result</span>) </span>&#123;</span><br><span class="line">  result; <span class="comment">// =&gt; &#123; code, map, ast &#125;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>或者是同步 api：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">babel.transformFileSync(<span class="string">"filename.js"</span>, options);</span><br><span class="line"><span class="comment">// =&gt; &#123; code, map, ast &#125;</span></span><br></pre></td></tr></table></figure>

<p>要是已经有一个 Babel AST（抽象语法树）了就可以直接从 AST 进行转换。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">babel.transformFromAst(ast, code, options);</span><br><span class="line"><span class="comment">// =&gt; &#123; code, map, ast &#125;</span></span><br></pre></td></tr></table></figure>

<p>更多选项 <a href="https://babeljs.io/docs/usage/api/#options" target="_blank" rel="noopener">options</a>.</p>
<h2 id="Babel-与-Webpack"><a href="#Babel-与-Webpack" class="headerlink" title="Babel 与 Webpack"></a>Babel 与 Webpack</h2><p>使用 <a href="https://github.com/babel/babel-loader" target="_blank" rel="noopener">babel-loader</a> 插件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yarn add bable-loader --dev</span><br></pre></td></tr></table></figure>
<p>webpack.config.js 配置文件增加如下规则：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">    loader: <span class="string">'babel-loader'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Babel-低版本浏览器兼容"><a href="#Babel-低版本浏览器兼容" class="headerlink" title="Babel 低版本浏览器兼容"></a>Babel 低版本浏览器兼容</h2><ul>
<li><a href="https://segmentfault.com/a/1190000009613296" target="_blank" rel="noopener">煦涵说webpack-IE低版本兼容指南</a>，或者FED实验室公众号文章</li>
<li><a href="https://github.com/xcatliu/react-ie8" target="_blank" rel="noopener">React - IE低版本兼容</a></li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2017/06/13/Babel/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2017/05/28/Webpack%20-%20IE%E4%BD%8E%E7%89%88%E6%9C%AC%E5%85%BC%E5%AE%B9%E6%8C%87%E5%8D%97/"
                            aria-label=": Webpack - IE低版本兼容指南"
                        >
                            Webpack - IE低版本兼容指南
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2017-05-28T13:41:35+08:00">
	
		    5月 28, 2017
    	
    </time>
    
        <span>发布在 </span>
        
    <a class="category-link" href="/categories/Web%E5%BC%80%E5%8F%91/">Web开发</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p><a href="https://webpack.js.org/" target="_blank" rel="noopener">Webpack</a>，Webpack 是一个前端资源加载/打包工具，现在版本已经 release 到 v2.6.1，今天的文章不直接介绍Webpack的API及使用，而是对最近项目开发中使用Webpack打包时处理IE低版本(IE8及以下)浏览器兼容问题做一次总结。</p>
<p>PC端项目前端基础技术选型jQuery + ES6 + EJS + Babel + Webpack：</p>
<ul>
<li>jQuery：提供选择器和ajax接口兼容支持；</li>
<li>ES6：跟进前端趋势，方便向后兼容；</li>
<li>EJS：提供前端模板引擎支持；</li>
<li>Babel：提供 ES6 转码支持；</li>
<li>Webpack: 提高前端资源加载/打包；</li>
</ul>
<p>项目开发过程都在 Chrome 浏览器中，一切都OK，没有任何问题，当在IE9以下浏览器中调试发现好多坑，现总结如下，以后新手参考。</p>
<h2 id="Case-One-default-、-class、catch-ES3中保留字问题"><a href="#Case-One-default-、-class、catch-ES3中保留字问题" class="headerlink" title="Case One: default 、 class、catch ES3中保留字问题"></a>Case One: <code>default</code> 、 <code>class</code>、<code>catch</code> ES3中保留字问题</h2><p>报错信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SCRIPT1048: 缺少标识符</span><br></pre></td></tr></table></figure>
<p>对应代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">e.n = <span class="function"><span class="keyword">function</span> (<span class="params">t</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> n = t &amp;&amp; t.__esModule ? <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> t.default</span><br><span class="line">    &#125; : <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> t</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> e.d(n, <span class="string">"a"</span>, n), n</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>网上查找资料，webpack有一款loader插件<a href="https://www.npmjs.com/package/es3ify-loader" target="_blank" rel="noopener">es3ify-loader</a>来处理ES3的兼容问题，修改webpack配置，问题解决，添加规则如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [&#123;</span><br><span class="line">            test: <span class="regexp">/.js$/</span>,</span><br><span class="line">            enforce: <span class="string">'post'</span>, <span class="comment">// post-loader处理</span></span><br><span class="line">            loader: <span class="string">'es3ify-loader'</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个loader是干啥用的捏，就是把这些保留字给你加上引号，使用字符串的形式引用，请看实例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 编译前</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">t</span>) </span>&#123; <span class="keyword">return</span> t.default; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 编译后</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">t</span>) </span>&#123; <span class="keyword">return</span> t[<span class="string">"default"</span>]; &#125;</span><br></pre></td></tr></table></figure>

<h2 id="Case-Two-uglify-js产生问题"><a href="#Case-Two-uglify-js产生问题" class="headerlink" title="Case Two: uglify-js产生问题"></a>Case Two: uglify-js产生问题</h2><p>重新构建，在IE低版本浏览器预览，使用 <code>webpack.optimize.UglifyJsPlugin</code> 压缩时，又报上面同样的错误了，重新采用 beauty:true, build 发现引号被压缩掉了，究其原因，研究了下uglify-js默认配置，发现了 <code>compress.properties</code> 属性，增加build options如下，问题解决：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.optimize.UglifyJsPlugin(&#123;</span><br><span class="line">    compress: &#123;</span><br><span class="line">        properties: <span class="literal">false</span>,</span><br><span class="line">        warnings: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        beautify: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    sourceMap: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="Case-Three-uglify-js问题"><a href="#Case-Three-uglify-js问题" class="headerlink" title="Case Three: uglify-js问题"></a>Case Three: uglify-js问题</h2><p>重新构建，在IE低版本浏览器预览，使用 <code>webpack.optimize.UglifyJsPlugin</code> 压缩时，又报上面同样的错误了，报错代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="keyword">catch</span>: <span class="function"><span class="keyword">function</span> (<span class="params">t</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.then(<span class="literal">null</span>, t)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>继续查找uglify-js配置，发现 <code>output.quote_keys</code>，修改build options，问题解决：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.optimize.UglifyJsPlugin(&#123;</span><br><span class="line">    compress: &#123;</span><br><span class="line">        properties: <span class="literal">false</span>,</span><br><span class="line">        warnings: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        beautify: <span class="literal">true</span>,</span><br><span class="line">        quote_keys: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    sourceMap: <span class="literal">false</span></span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure>
<p>编译后：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"catch"</span>: <span class="function"><span class="keyword">function</span>(<span class="params">t</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.then(<span class="literal">null</span>, t);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Case-Four-uglify-js问题"><a href="#Case-Four-uglify-js问题" class="headerlink" title="Case Four: uglify-js问题"></a>Case Four: uglify-js问题</h2><p>重新构建，在IE低版本浏览器预览，报错信息如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SCRIPT3126: 无法设置未定义或 null 引用的属性</span><br></pre></td></tr></table></figure>
<p>继续分析压缩后代码，发现还是uglify-js问题，其mangle 配置属性 <code>mangle.screw_ie8</code> 默认为 true， 什么意思捏，意思就是把支持IE8的代码clear掉，screw you =&gt; 去你的，修改压缩配置项，重新编译，问题解决：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.optimize.UglifyJsPlugin(&#123;</span><br><span class="line">    compress: &#123;</span><br><span class="line">        properties: <span class="literal">false</span>,</span><br><span class="line">        warnings: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        beautify: <span class="literal">true</span>,</span><br><span class="line">        quote_keys: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    mangle: &#123;</span><br><span class="line">        screw_ie8: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    sourceMap: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="Case-Five-ES5的API兼容报错"><a href="#Case-Five-ES5的API兼容报错" class="headerlink" title="Case Five: ES5的API兼容报错"></a>Case Five: ES5的API兼容报错</h2><p>在 webpack 的 entry 入口文件top引入 <code>es5-shim</code> 问题解决</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'es5-shim'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'es5-shim/es5-sham'</span>);</span><br></pre></td></tr></table></figure>
<h2 id="Case-Six-Console-log-问题"><a href="#Case-Six-Console-log-问题" class="headerlink" title="Case Six: Console.log 问题"></a>Case Six: Console.log 问题</h2><p>在 webpack 的 entry 入口文件top引入 <code>console-polyfill</code> 问题解决</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'console-polyfill'</span>);</span><br></pre></td></tr></table></figure>

<h2 id="Case-Seven-Promise-兼容"><a href="#Case-Seven-Promise-兼容" class="headerlink" title="Case Seven: Promise 兼容"></a>Case Seven: Promise 兼容</h2><p>在 webpack 的 entry 入口文件top引入 <code>es6-promise</code> 问题解决</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'es6-promise'</span>);</span><br></pre></td></tr></table></figure>

<h2 id="Case-Eight-Object-defineProperty-问题"><a href="#Case-Eight-Object-defineProperty-问题" class="headerlink" title="Case Eight: Object.defineProperty 问题"></a>Case Eight: Object.defineProperty 问题</h2><p>这个case 应该说是最难搞的一个case了，耗时也比较长，关键点在于使用 <code>es5-shim</code>/<code>es5-sham</code>也有问题，查看你官网发现在低版本浏览器也会有问题，官网描述如下：</p>
<blockquote>
<p>⚠️ Object.defineProperty<br>In the worst of circumstances, IE 8 provides a version of this method that only works on DOM objects. This sham will not be installed. The given version of defineProperty will throw an exception if used on non-DOM objects.<br>In slightly better circumstances, this method will silently fail to set “writable”, “enumerable”, and “configurable” properties.<br>Providing a getter or setter with “get” or “set” on a descriptor will silently fail on engines that lack “defineGetter” and “defineSetter”, which include all versions of IE.<br><a href="https://github.com/es-shims/es5-shim/issues#issue/5" target="_blank" rel="noopener">https://github.com/es-shims/es5-shim/issues#issue/5</a></p>
</blockquote>
<p>那这个Object.defineProperty 是如何产生的呢，这个是babel编译后产生的，当我们在代码使用 <code>import</code> <code>export</code> ES6 Module时出现的，那你可能最直接的想法就是我不用ES6 Module了，改用Commonjs规范，OK，修改后编译，确实解决了问题，但是查看代码里还是有一段代码的，如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">e.d = <span class="function"><span class="keyword">function</span>(<span class="params">t, n, r</span>) </span>&#123;</span><br><span class="line">    e.o(t, n) || <span class="built_in">Object</span>.defineProperty(t, n, &#123;</span><br><span class="line">        <span class="string">"configurable"</span>: !<span class="number">1</span>,</span><br><span class="line">        <span class="string">"enumerable"</span>: !<span class="number">0</span>,</span><br><span class="line">        <span class="string">"get"</span>: r</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;, e.n = <span class="function"><span class="keyword">function</span>(<span class="params">t</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> n = t &amp;&amp; t.__esModule ? <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> t[<span class="string">"default"</span>];</span><br><span class="line">    &#125; : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> e.d(n, <span class="string">"a"</span>, n), n;</span><br><span class="line">&#125;, e.o = <span class="function"><span class="keyword">function</span>(<span class="params">t, e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.hasOwnProperty.call(t, e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看代码已经做了容错判断。</p>
<h2 id="Case-Nine-Object-defineProperty-问题"><a href="#Case-Nine-Object-defineProperty-问题" class="headerlink" title="Case Nine: Object.defineProperty 问题"></a>Case Nine: Object.defineProperty 问题</h2><p>重新构建，加入 <code>json3</code> 处理 JSON 对象兼容时，代码在此处抛出了异常：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> hasGetter = <span class="string">'get'</span> <span class="keyword">in</span> descriptor;</span><br><span class="line"><span class="keyword">var</span> hasSetter = <span class="string">'set'</span> <span class="keyword">in</span> descriptor;</span><br><span class="line"><span class="keyword">if</span> (!supportsAccessors &amp;&amp; (hasGetter || hasSetter)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(ERR_ACCESSORS_NOT_SUPPORTED);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>分析supportsAccessors代码逻辑：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> supportsAccessors = owns(prototypeOfObject, <span class="string">'__defineGetter__'</span>);</span><br></pre></td></tr></table></figure>
<p>通过断点调试，supportsAccessors值为false且hasGetter或者hasSetter时抛出了异常，也就是说当前js引擎不支持访问器属性，却在属性描述符中设置了get，set,那么就会抛出异常。查看 <a href="“defineGetter”的兼容情况是只兼容IE11">defineGetter</a> 的兼容情况，只兼容IE11，虽然IE9、IE10同样不支持defineGetter,不过他们直接支持Object.defineProperty方法和get语法，无需sham，所以代码并不会走到异常这里。但是IE8以下就扯淡了。解决这种情况只能修改源代码了。</p>
<p>至此，Webpack打包时，IE低版本浏览器(IE8及以下)遇到的兼容问题就总结这里，如果你有新的问题，欢迎留言。</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2017/05/28/Webpack%20-%20IE%E4%BD%8E%E7%89%88%E6%9C%AC%E5%85%BC%E5%AE%B9%E6%8C%87%E5%8D%97/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2017/05/20/Flow/"
                            aria-label=": Flow"
                        >
                            Flow
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2017-05-20T13:33:45+08:00">
	
		    5月 20, 2017
    	
    </time>
    
        <span>发布在 </span>
        
    <a class="category-link" href="/categories/Web%E5%BC%80%E5%8F%91/">Web开发</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p><a href="https://flow.org" target="_blank" rel="noopener">Flow</a>是Facebook出品的一个JavaScript代码的静态类型检查工具，它做了很多处理，使您的代码更快，更智能，更自信，更好的适应性。现在已经在前端比较流行的React 、Vue 等框架中得到使用。今天煦涵就和大家一起来学习Flow以及在实际项目中的使用。</p>
<h2 id="Flow-安装"><a href="#Flow-安装" class="headerlink" title="Flow 安装"></a>Flow 安装</h2><p>这里我们选择使用 <code>yarn</code>，当前你也可以使用 <code>npm</code>, 如果你对 <code>yarn</code>不是很了解，建议你阅读 <strong>煦涵说Yarn</strong>。首先我们先初始化一个 <code>flow</code> 项目，安装完编译器，然后再安装 <code>flow</code> 。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir flow-project</span><br><span class="line">cd flow-project</span><br><span class="line">yarn init</span><br><span class="line"></span><br><span class="line">yarn add --dev babel-cli babel-preset-flow babel-preset-es2015</span><br></pre></td></tr></table></figure>
<p>项目根目录下创建 <code>.babelrc</code> 文件，并增加如下内容：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"presets"</span>: [<span class="string">"flow"</span>, <span class="string">"es2015"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>安装 Flow:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev flow-bin</span><br></pre></td></tr></table></figure>

<p>运行 flow：<br>需要在根目录下新建一个 <code>.flowconfig</code> 文件，不然会报找不到该文件错误。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn run flow</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yarn run v0.16.1</span><br><span class="line">$ &quot;&#x2F;flow-proj&#x2F;node_modules&#x2F;.bin&#x2F;flow&quot; </span><br><span class="line">Launching Flow server for &#x2F;flow-proj</span><br><span class="line">Spawned flow server (pid&#x3D;17242)</span><br><span class="line">Logs will go to &#x2F;private&#x2F;tmp&#x2F;flow&#x2F;zSvue-workspacezSflow-proj.log</span><br><span class="line">No errors!</span><br><span class="line">✨  Done in 2.48s.</span><br></pre></td></tr></table></figure>

<h2 id="Flow-使用"><a href="#Flow-使用" class="headerlink" title="Flow 使用"></a>Flow 使用</h2><p>我们先在根目录下新建src目录，并新建一个index.js文件。同时在 <code>package.json</code> 文件中增加下面scripts内容，以方便我们后期的命令行编译。<br>index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @flow</span></span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>].map(<span class="function">(<span class="params">item:number, index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> item * item;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>package.json</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"build"</span>: <span class="string">"yarn run flow &amp;&amp; babel src -d lib"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行 <code>yarn run build</code>， 没有报错， 会在生成lib文件目录，index.js的 flow type 注释会被 remove 掉，同时进行了箭头函数到ES5的转换。<br>如果我修改上面index.js的代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @flow</span></span><br><span class="line">[<span class="string">'1'</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>].map(<span class="function">(<span class="params">item:number, index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> item * item;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>运行 <code>yarn run build</code>，会报如下类型检测错误：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">yarn run v0.16.1</span><br><span class="line">$ &quot;&#x2F;flow-proj&#x2F;node_modules&#x2F;.bin&#x2F;flow&quot; </span><br><span class="line">src&#x2F;index.js:3</span><br><span class="line">  3: [&#39;1&#39;,2,3,4].map((item:number, index) &#x3D;&gt; &#123;</span><br><span class="line">      ^^^ string. This type is incompatible with the expected param type of</span><br><span class="line">  3: [&#39;1&#39;,2,3,4].map((item:number, index) &#x3D;&gt; &#123;</span><br><span class="line">                           ^^^^^^ number</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Found 1 error</span><br><span class="line">error Command failed with exit code 2.</span><br><span class="line">info Visit https:&#x2F;&#x2F;yarnpkg.com&#x2F;en&#x2F;docs&#x2F;cli&#x2F;run for documentation about this command.</span><br><span class="line">error Command failed with exit code 1.</span><br><span class="line">info Visit https:&#x2F;&#x2F;yarnpkg.com&#x2F;en&#x2F;docs&#x2F;cli&#x2F;run for documentation about this command.</span><br></pre></td></tr></table></figure>

<p>更多类型坚持实例不再一一列举，官网有很多介绍type的例子。</p>
<h2 id="Flow-配置文件"><a href="#Flow-配置文件" class="headerlink" title="Flow 配置文件"></a>Flow 配置文件</h2><p>上面提到没有配置文件，会报错，<code>.flowconfig</code> 文件由以下5个部分组成：</p>
<ul>
<li>[include] –包含的文件或者目录</li>
<li>[ignore]  –忽略的文件或者目录，支持正则匹配</li>
<li>[libs]    –第三方库支持，项目根目录下的flow-typed目录作为库目录</li>
<li>[options] –默认键值对配置，某些选项可以使用命令行方式重载</li>
<li>[version] –期望使用的Flow版本</li>
</ul>
<h2 id="流行编辑器插件支持"><a href="#流行编辑器插件支持" class="headerlink" title="流行编辑器插件支持"></a>流行编辑器插件支持</h2><ul>
<li>Visual Studio Code: Flow-Language-Support </li>
<li>Sublime Text:Flow 和 SublimeLinter-flow<br>更多请参考：<a href="https://flow.org/en/docs/editors/" target="_blank" rel="noopener">https://flow.org/en/docs/editors/</a></li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2017/05/20/Flow/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2017/05/13/Yarn/"
                            aria-label=": Yarn"
                        >
                            Yarn
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2017-05-13T12:50:16+08:00">
	
		    5月 13, 2017
    	
    </time>
    
        <span>发布在 </span>
        
    <a class="category-link" href="/categories/Web%E5%BC%80%E5%8F%91/">Web开发</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p><a href="https://yarnpkg.com" target="_blank" rel="noopener">Yarn</a>是一个新的Javascript包管理器，它由Facebook, Google, Exponent and Tilde开发者共同开发完成。Yarn 不是 NPM 的fork版本，而是它的重新设计，Yarn 定位为”快速、可靠、安全的依赖管理工具”，它的目标是解决团队开发中使用 NPM 遇到的问题。</p>
<p>随着 Yarn 的诞生，越来越多的开发者转向了 Yarn，那么 NPM 在开发中有哪些问题，Yarn 是如何解决的呢？<br>NPM 一些潜在的问题:</p>
<ul>
<li>嵌套依赖 (npm 3.0版本已修复)</li>
<li>串行安装</li>
<li>单一个 package 来源（npmjs.com）</li>
<li>需要网络来安装软件包（尽管我们可以创建一个临时缓存）</li>
<li>允许程序包在安装时运行代码（不利于安全性）</li>
<li>不确定的包状态（不能确定项目的所有副本使用相同的包版本）</li>
</ul>
<p>Yarn 解决方案:</p>
<ul>
<li>单依赖包结构: 可以使用单一版本的依赖包，安装更快速，占用磁盘空间更少</li>
<li>并行安装: 并行下载依赖包，减少下载时间</li>
<li>多个包来源: Yarn 读取和安装 npmjs.com 和 Bower安装包，如果有个渠道down掉了，可以从另一个渠道下载包并安装</li>
<li>自动重试: 单个网络请求失败不会导致安装失败，请求在失败后会重试，这解决了由于临时网络问题而产生的构建异常</li>
<li>兼容 NPM: 从 NPM 切换到 Yarn 不需要做特殊兼容处理</li>
<li>yarn.lock: 用来管理 javascript 包，这个对于开发团队来说可能是最有用的功能了。 在package.json中，依赖的包版本可以被指定为一个范围，也可以不带版本号。这个可能会导致一种问题，团队内不同开发人员使用不同版本的软件包。我们都知道，复现环境的能力与完全相关的依赖关系对于高校的调试和新团队人员的融入至关重要。从包管理器（Bundler）中借鉴，Yarn 创建了 yarn.lock文件，用来记录项目使用每个包的确切版本。当将此文件提交至 SVN、GIT 等代码维护工具，可以保证项目的所有开发人员共享一套依赖包的版本号。</li>
</ul>
<h2 id="Yarn-的安装"><a href="#Yarn-的安装" class="headerlink" title="Yarn 的安装"></a>Yarn 的安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">brew install yarn</span><br><span class="line"></span><br><span class="line">&#x2F;* Yarn 团队不推荐 *&#x2F;</span><br><span class="line">npm install -g yarn</span><br></pre></td></tr></table></figure>
<p>不同平台安装方式各异，具体参见<a href="https://yarnpkg.com/zh-Hans/docs/install" target="_blank" rel="noopener">install</a></p>
<h2 id="NPM-CLI-vs-Yarn-CLI"><a href="#NPM-CLI-vs-Yarn-CLI" class="headerlink" title="NPM CLI vs Yarn CLI"></a>NPM CLI vs Yarn CLI</h2><ul>
<li>初始化项目<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm  init</span><br><span class="line">yarn init</span><br></pre></td></tr></table></figure></li>
<li>从 package.json 安装依赖<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br><span class="line">yarn</span><br></pre></td></tr></table></figure></li>
<li>安装指定包到依赖或者开发依赖<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm install --save [package]</span><br><span class="line">yarn add [package]</span><br><span class="line"></span><br><span class="line">npm install --save-dev [package]</span><br><span class="line">yarn add [package] [--dev&#x2F;-D]</span><br></pre></td></tr></table></figure></li>
<li>安装包到全局<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install --global [package]</span><br><span class="line">yarn global add [package]</span><br></pre></td></tr></table></figure></li>
<li>安装指定版本的包<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install [package]@[version]</span><br><span class="line">yarn add [package]@[version]</span><br></pre></td></tr></table></figure></li>
<li>重新下载所有包<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm rebuild</span><br><span class="line">yarn install --force</span><br></pre></td></tr></table></figure></li>
<li>卸载包<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall [package]</span><br><span class="line"></span><br><span class="line">npm uninstall --save [package]</span><br><span class="line">yarn remove [package]</span><br><span class="line"></span><br><span class="line">npm uninstall --save-dev [package]</span><br></pre></td></tr></table></figure></li>
<li>升级包<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm -rf node_modules &amp;&amp; npm install</span><br><span class="line">yarn upgrade</span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2>相比 NPM，Yarn解决了不确定依赖、网络问题、并行下载等问题。然而 NPM 是自己成功的牺牲品，随着越来越多的开发者转移使用 Yarn或者其他依赖平台，NPM 服务器可以更有效的使用。总之两个包管理器都很优秀，这种相互的关系，驱使着各自彼此往更优秀的方向前进，以惠及更多的开发者。</li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2017/05/13/Yarn/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
          <li class="pagination-next">
            <a
                class="btn btn--default btn--small"
                href="/categories/Web%E5%BC%80%E5%8F%91/page/2/"
                aria-label="下一页"
            >
              <span>下一页</span>
              <i class="fa fa-angle-right text-base icon-ml"></i>
            </a>
          </li>
        
        <li class="pagination-number">第 1 页 共 2 页</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2020 煦涵. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="https://avatars0.githubusercontent.com/u/5378965?s=460&amp;v=4" alt="作者的图片"/>
        
            <h4 id="about-card-name">煦涵</h4>
        
            <div id="about-card-bio"><p>因为热爱，所以坚持。</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Front-end Engineer</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Beijing
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-ogaxrurcpmycz7m6zn50p8mo6tatzjf3bim6ghv4axcaiqa908v5le39rcgp.min.js"></script>

<!--SCRIPTS END-->





    </body>
</html>
